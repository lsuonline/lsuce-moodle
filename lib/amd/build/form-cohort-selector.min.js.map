{"version":3,"file":"form-cohort-selector.min.js","names":["define","ajax","$","processResults","selector","data","results","i","excludelist","split","cohorts","length","indexOf","id","push","value","label","name","transport","query","success","failure","el","promises","contextid","searchargs","includes","limitfrom","limitnum","context","call","methodname","args","when","apply","done","fail"],"sources":["../src/form-cohort-selector.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Course selector adaptor for auto-complete form element.\n *\n * @module     core/form-cohort-selector\n * @class      form-cohort-selector\n * @package    core\n * @copyright  2016 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.1\n */\ndefine(['core/ajax', 'jquery'], function(ajax, $) {\n\n    return /** @alias module:core/form-cohort-selector */ {\n        // Public variables and functions.\n        processResults: function(selector, data) {\n            // Mangle the results into an array of objects.\n            var results = [];\n            var i = 0;\n            var excludelist = String($(selector).data('exclude')).split(',');\n\n            for (i = 0; i < data.cohorts.length; i++) {\n                if (excludelist.indexOf(String(data.cohorts[i].id)) === -1) {\n                    results.push({value: data.cohorts[i].id, label: data.cohorts[i].name});\n                }\n            }\n            return results;\n        },\n\n        transport: function(selector, query, success, failure) {\n            var el = $(selector);\n\n            // Parse some data-attributes from the form element.\n\n            // Build the query.\n            var promises = null;\n\n            if (typeof query === \"undefined\") {\n                query = '';\n            }\n            var contextid = el.data('contextid');\n\n            var searchargs = {\n                query: query,\n                includes: 'parents',\n                limitfrom: 0,\n                limitnum: 100,\n                context: {contextid: contextid}\n            };\n\n            var calls = [{\n                methodname: 'core_cohort_search_cohorts', args: searchargs\n            }];\n\n            // Go go go!\n            promises = ajax.call(calls);\n            $.when.apply($.when, promises).done(function(data) {\n                success(data);\n            }).fail(failure);\n        }\n    };\n});\n"],"mappings":"AAyBAA,OAAM,6BAAC,CAAC,WAAW,CAAE,QAAQ,CAAC,CAAE,SAASC,CAAI,CAAEC,CAAC,CAAE,CAE9C,MAAsD,CAElDC,cAAc,CAAE,SAAAA,eAASC,CAAQ,CAAEC,CAAI,CAAE,IAEjC,CAAAC,CAAO,CAAG,EAAE,CACZC,CAAC,CAAG,CAAC,CACLC,CAAW,CAAG,CAAON,CAAC,CAACE,CAAQ,CAAC,CAACC,IAAI,CAAC,SAAS,CAAC,KAAEI,KAAK,CAAC,GAAG,CAAC,CAEhE,IAAKF,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAGF,CAAI,CAACK,OAAO,CAACC,MAAM,CAAEJ,CAAC,EAAE,CAAE,CACtC,GAAwD,CAAC,CAAC,GAAtDC,CAAW,CAACI,OAAO,CAAQP,CAAI,CAACK,OAAO,CAACH,CAAC,CAAC,CAACM,EAAE,IAAS,CAAE,CACxDP,CAAO,CAACQ,IAAI,CAAC,CAACC,KAAK,CAAEV,CAAI,CAACK,OAAO,CAACH,CAAC,CAAC,CAACM,EAAE,CAAEG,KAAK,CAAEX,CAAI,CAACK,OAAO,CAACH,CAAC,CAAC,CAACU,IAAI,CAAC,CACzE,CACJ,CACA,MAAO,CAAAX,CACX,CAAC,CAEDY,SAAS,CAAE,SAAAA,UAASd,CAAQ,CAAEe,CAAK,CAAEC,CAAO,CAAEC,CAAO,CAAE,IAC/C,CAAAC,CAAE,CAAGpB,CAAC,CAACE,CAAQ,CAAC,CAKhBmB,CAAQ,CAAG,IAAI,CAEnB,GAAqB,WAAW,EAA5B,MAAO,CAAAJ,CAAqB,CAAE,CAC9BA,CAAK,CAAG,EACZ,CAAC,GACG,CAAAK,CAAS,CAAGF,CAAE,CAACjB,IAAI,CAAC,WAAW,CAAC,CAEhCoB,CAAU,CAAG,CACbN,KAAK,CAAEA,CAAK,CACZO,QAAQ,CAAE,SAAS,CACnBC,SAAS,CAAE,CAAC,CACZC,QAAQ,CAAE,GAAG,CACbC,OAAO,CAAE,CAACL,SAAS,CAAEA,CAAS,CAClC,CAAC,CAODD,CAAQ,CAAGtB,CAAI,CAAC6B,IAAI,CALR,CAAC,CACTC,UAAU,CAAE,4BAA4B,CAAEC,IAAI,CAAEP,CACpD,CAAC,CAAC,CAGyB,CAC3BvB,CAAC,CAAC+B,IAAI,CAACC,KAAK,CAAChC,CAAC,CAAC+B,IAAI,CAAEV,CAAQ,CAAC,CAACY,IAAI,CAAC,SAAS9B,CAAI,CAAE,CAC/Ce,CAAO,CAACf,CAAI,CAChB,CAAC,CAAC,CAAC+B,IAAI,CAACf,CAAO,CACnB,CACJ,CACJ,CAAC,CAAC"}