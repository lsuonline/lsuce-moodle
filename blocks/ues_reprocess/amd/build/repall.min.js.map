{"version":3,"file":"repall.min.js","sources":["../src/repall.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Reprocess All Tool\n * @copyright  Louisiana State University\n * @copyright  The guy who did stuff: David Lowe\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax'], function($, Ajax) {\n    var t = {\n\n        /**\n         * Used to track when the category really changes.\n         */\n        lastYear: null,\n        lastSemester: null,\n        lastDepartment: null,\n        lastCourse: null,\n        /**\n         * Initialise the handling.\n         */\n        init: function() {\n            $('select#id_ues_year').on('change', function() {\n                $('select#id_ues_courses').empty();\n\n                t.lastYear = $('select#id_ues_year').val();\n\n                t.formChange({\n                    'name': t.lastYear,\n                    'id': \"select#id_ues_year\",\n                    'meth': \"ues_reprocess_get_courses\",\n                    'args': {\n                        'year': $('select#id_ues_year option:selected').text(),\n                        'semester': $('select#id_ues_semesters').val(),\n                        'department': $('select#id_ues_departments').val(),\n                        'update': 'select#id_ues_courses'\n                    },\n                });\n            });\n\n            $('select#id_ues_semesters').on('change', function() {\n                $('select#id_ues_courses').empty();\n                t.lastSemester = $('select#id_ues_semesters').val();\n                t.formChange({\n                    'name': t.lastSemester,\n                    'id': \"select#id_ues_semesters\",\n                    'meth': \"ues_reprocess_get_courses\",\n                    'args': {\n                        'year': $('select#id_ues_year option:selected').text(),\n                        'semester': $('select#id_ues_semesters').val(),\n                        'department': $('select#id_ues_departments').val(),\n                        // The field to update with new data.\n                        'update': 'select#id_ues_courses'\n                    },\n                });\n            });\n\n            $('select#id_ues_departments').on('change', function() {\n                t.lastDepartment = $('select#id_ues_departments').val();\n                $('select#id_ues_courses').empty();\n                t.formChange({\n                    'name': t.lastDepartment,\n                    'id': \"select#id_ues_departments\",\n                    'meth': \"ues_reprocess_get_courses\",\n                    'args': {\n                        'year': $('select#id_ues_year option:selected').text(),\n                        'semester': $('select#id_ues_semesters').val(),\n                        'department': $('select#id_ues_departments').val(),\n                        // The field to update with new data.\n                        'update': 'select#id_ues_courses'\n                    },\n                });\n            });\n            $('select#id_ues_courses').on('change', function() {\n                t.lastCourse = $('select#id_ues_courses').val();\n                $(\"input[name='ues_courses_h']\").val($('select#id_ues_courses').val());\n                /*\n                t.formChange({\n                    'name': t.lastCourse,\n                    'id': 'select#id_ues_courses',\n                    'meth': 'ues_reprocess_get_sections',\n                    'args': {\n                        'year': $('select#id_ues_year option:selected').text(),\n                        'semester': $('select#id_ues_semesters').val(),\n                        'department': $('select#id_ues_departments').val(),\n                        'course': $('select#id_ues_courses').val(),\n                        // The field to update with new data.\n                        'update': 'select#id_ues_sections'\n                    },\n                });\n                */\n            });\n\n            t.year = null;\n            t.lastSemester = null;\n            t.lastDepartment = null;\n            t.lastCourse = null;\n        },\n\n        /**\n         * Source of data for Ajax element.\n         *\n         * @param {Object} obj - params used to build the call.\n         */\n        formChange: function(obj) {\n            console.log(\"Data to send: \", obj);\n            if (obj.args.course === null) {\n                obj.args.course = '';\n            }\n            if (t[obj.name] === '') {\n                t.updateChoices([]);\n            } else {\n\n                Ajax.call([{\n                    // get_sharable_question_choices\n                    'methodname': obj.meth,\n                    'args': obj.args\n                }])[0].done(t.updateChoices)\n\n                .fail(function ( jqXHR, textStatus, errorThrown ) {\n                    console.log(jqXHR);\n                    console.log(textStatus);\n                    console.log(errorThrown);\n                });\n            }\n        },\n\n        /**\n         * Update the contents of the Question select with the results of the AJAX call.\n         *\n         * @param {Array} response - array of options, each has fields value and label.\n         */\n        updateChoices: function(response) {\n            console.log(\"What is the returing obj: \", response);\n            $('span#repall_estimator_course').text(response.csize);\n            $('span#repall_estimator_time').text(\n                new Date((response.csize * 4) * 1000).toISOString().slice(11, 19)\n            );\n\n            // If there is nothing to update on the form then abort.\n            if (response.update == \"none\") {\n                return;\n            }\n            var select = $(response.update);\n            select.empty();\n            $(response.data).each(function(index, option) {\n                select.append('<option value=\"' + option.value + '\">' + option.label + '</option>');\n            });\n            // M.util.js_complete('ues_reprocess-get_departments');\n        }\n    };\n    return t;\n});"],"names":["define","$","Ajax","t","lastYear","lastSemester","lastDepartment","lastCourse","init","on","empty","val","formChange","text","year","obj","console","log","args","course","name","updateChoices","call","meth","done","fail","jqXHR","textStatus","errorThrown","response","csize","Date","toISOString","slice","update","select","data","each","index","option","append","value","label"],"mappings":";;;;;;AAsBAA,oCAAO,CAAC,SAAU,cAAc,SAASC,EAAGC,UACpCC,EAAI,CAKJC,SAAU,KACVC,aAAc,KACdC,eAAgB,KAChBC,WAAY,KAIZC,KAAM,WACFP,EAAE,sBAAsBQ,GAAG,UAAU,WACjCR,EAAE,yBAAyBS,QAE3BP,EAAEC,SAAWH,EAAE,sBAAsBU,MAErCR,EAAES,WAAW,MACDT,EAAEC,YACJ,0BACE,iCACA,MACIH,EAAE,sCAAsCY,gBACpCZ,EAAE,2BAA2BU,iBAC3BV,EAAE,6BAA6BU,aACnC,8BAKtBV,EAAE,2BAA2BQ,GAAG,UAAU,WACtCR,EAAE,yBAAyBS,QAC3BP,EAAEE,aAAeJ,EAAE,2BAA2BU,MAC9CR,EAAES,WAAW,MACDT,EAAEE,gBACJ,+BACE,iCACA,MACIJ,EAAE,sCAAsCY,gBACpCZ,EAAE,2BAA2BU,iBAC3BV,EAAE,6BAA6BU,aAEnC,8BAKtBV,EAAE,6BAA6BQ,GAAG,UAAU,WACxCN,EAAEG,eAAiBL,EAAE,6BAA6BU,MAClDV,EAAE,yBAAyBS,QAC3BP,EAAES,WAAW,MACDT,EAAEG,kBACJ,iCACE,iCACA,MACIL,EAAE,sCAAsCY,gBACpCZ,EAAE,2BAA2BU,iBAC3BV,EAAE,6BAA6BU,aAEnC,8BAItBV,EAAE,yBAAyBQ,GAAG,UAAU,WACpCN,EAAEI,WAAaN,EAAE,yBAAyBU,MAC1CV,EAAE,+BAA+BU,IAAIV,EAAE,yBAAyBU,UAkBpER,EAAEW,KAAO,KACTX,EAAEE,aAAe,KACjBF,EAAEG,eAAiB,KACnBH,EAAEI,WAAa,MAQnBK,WAAY,SAASG,KACjBC,QAAQC,IAAI,iBAAkBF,KACN,OAApBA,IAAIG,KAAKC,SACTJ,IAAIG,KAAKC,OAAS,IAEF,KAAhBhB,EAAEY,IAAIK,MACNjB,EAAEkB,cAAc,IAGhBnB,KAAKoB,KAAK,CAAC,YAEOP,IAAIQ,UACVR,IAAIG,QACZ,GAAGM,KAAKrB,EAAEkB,eAEbI,MAAK,SAAWC,MAAOC,WAAYC,aAChCZ,QAAQC,IAAIS,OACZV,QAAQC,IAAIU,YACZX,QAAQC,IAAIW,iBAUxBP,cAAe,SAASQ,aACpBb,QAAQC,IAAI,6BAA8BY,UAC1C5B,EAAE,gCAAgCY,KAAKgB,SAASC,OAChD7B,EAAE,8BAA8BY,KAC5B,IAAIkB,KAAuB,EAAjBF,SAASC,MAAa,KAAME,cAAcC,MAAM,GAAI,KAI3C,QAAnBJ,SAASK,YAGTC,OAASlC,EAAE4B,SAASK,QACxBC,OAAOzB,QACPT,EAAE4B,SAASO,MAAMC,MAAK,SAASC,MAAOC,QAClCJ,OAAOK,OAAO,kBAAoBD,OAAOE,MAAQ,KAAOF,OAAOG,MAAQ,0BAK5EvC"}