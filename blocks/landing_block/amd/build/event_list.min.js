define ("block_landing_block/event_list",["jquery","core/notification","core/templates","core/custom_interaction_events","block_myoverview/calendar_events_repository"],function(a,b,c,d,e){var f={EMPTY_MESSAGE:"[data-region=\"empty-message\"]",ROOT:"[data-region=\"event-list-container\"]",EVENT_LIST:"[data-region=\"event-list\"]",EVENT_LIST_CONTENT:"[data-region=\"event-list-content\"]",EVENT_LIST_GROUP_CONTAINER:"[data-region=\"event-list-group-container\"]",LOADING_ICON_CONTAINER:"[data-region=\"loading-icon-container\"]",VIEW_MORE_BUTTON:"[data-action=\"view-more\"]"},g={EVENT_LIST_ITEMS:"block_myoverview/event-list-items",COURSE_EVENT_LIST_ITEMS:"block_myoverview/course-event-list-items"},h=function(a){a.attr("data-loaded-all",!0)},i=function(a){return!!a.attr("data-loaded-all")},j=function(a){var b=a.find(f.LOADING_ICON_CONTAINER),c=a.find(f.VIEW_MORE_BUTTON);a.addClass("loading");b.removeClass("hidden");c.prop("disabled",!0)},k=function(a){var b=a.find(f.LOADING_ICON_CONTAINER),c=a.find(f.VIEW_MORE_BUTTON);a.removeClass("loading");b.addClass("hidden");if(!i(a)){c.prop("disabled",!1)}},l=function(a){return a.hasClass("loading")},m=function(a){a.attr("data-has-events",!0)},n=function(a){return a.attr("data-has-events")?!0:!1},o=function(a,b){if(b){m(a)}else{if(!n(a)){p(a)}}},p=function(a){a.find(f.EVENT_LIST_CONTENT).addClass("hidden");a.find(f.EMPTY_MESSAGE).removeClass("hidden")},q=function(a,b,d){a.removeClass("hidden");return c.render(d,{events:b}).done(function(b,d){c.appendNodeContents(a.find(f.EVENT_LIST),b,d)})},r=function(a,b){var c=b.timesort||0;return c-a},s=function(a,b,c){var d=a.attr("data-midnight"),e=+c.attr("data-start-day")*86400,f=+c.attr("data-end-day")*86400,g=r(d,b);if(""===c.attr("data-end-day")){return e<=g}else{return e<=g&&g<f}},t=function(b,c){return function(d){return s(b,d,a(c))}},u=function(b,c){var d=0,e=g.EVENT_LIST_ITEMS;if(b.attr("data-course-id")){e=g.COURSE_EVENT_LIST_ITEMS}return a.when.apply(a,a.map(b.find(f.EVENT_LIST_GROUP_CONTAINER),function(f){var g=c.filter(t(b,f));if(g.length){d+=g.length;return q(a(f),g,e)}else{return null}})).then(function(){return d})},v=function(c,d){c=a(c);var f=+c.attr("data-limit"),g=+c.attr("data-course-id"),i=c.attr("data-last-id"),m=c.attr("data-midnight");if(l(c)){return a.Deferred().resolve()}j(c);if("undefined"==typeof d){var n={starttime:m-1209600,limit:f};if(i){n.aftereventid=i}if(g){n.courseid=g;d=e.queryByCourse(n)}else{d=e.queryByTime(n)}}return d.then(function(a){return a.events}).then(function(a){if(!a.length||a.length<f){h(c)}if(a.length){c.attr("data-last-id",a[a.length-1].id);return u(c,a).then(function(b){o(c,a.length);if(b<a.length){h(c)}})}else{o(c,a.length)}}).fail(b.exception).always(function(){k(c)})},w=function(a){d.define(a,[d.events.activate]);a.on(d.events.activate,f.VIEW_MORE_BUTTON,function(){v(a)})};return{init:function init(b){b=a(b);v(b);w(b)},registerEventListeners:w,load:v,rootSelector:f.ROOT}});
//# sourceMappingURL=event_list.min.js.map
