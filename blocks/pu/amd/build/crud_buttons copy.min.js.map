{"version":3,"file":"crud_buttons copy.min.js","names":["define","$","noti","PULib","check_file_exists","params","jaxyPromise","call","class","confirmCheckExecute","console","log","callYesNoModi","then","response","status","useless","registerEvents","on","ev","preventDefault","row_data","record","closest","data","this_form","title","body","save_button","mfileid","find","val","append","submit","init"],"sources":["../src/crud_buttons copy.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Cross Enrollment Tool\n *\n * @package   block_pu\n * @copyright 2008 onwards Louisiana State University\n * @copyright 2008 onwards David Lowe, Robert Russo\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n define(['jquery', 'block_pu/notifications', 'block_pu/pu_lib'],\n    function($, noti, PULib) {\n    'use strict';\n    return {\n        /**\n         * Check if the file exists\n         * @param {object} the json object sent to the server\n         * @return resolved data\n         */\n        check_file_exists: function (params) {\n            return PULib.jaxyPromise({\n                'call': 'check_file_exists',\n                'params': params,\n                'class': 'pufile'\n            });\n        },\n\n\n        confirmCheckExecute: function (params) {\n            // First let's confirm\n            console.log(\"What are the params: \", params);\n            noti.callYesNoModi(params).then(function (response) {\n\n                console.log(\"Chaning 2 BITCH\");\n                if (response.status == true) {\n                    // console.log(\"Copy button CLICKED -> TRUE\");\n\n                    // console.log(\"Do we have this: \", this);\n                    // console.log(\"Do we have that: \", that);\n                    return response;\n                }\n            }).then(function (response) {\n                // We need to check if the file exists.\n                console.log(\"Chaing 2 what is response: \", response);\n                PULib.useless();\n                // return new Promise((resolve, reject) => { // (*)\n                //     setTimeout(() => resolve(result * 2), 1000);\n                // });\n\n                // that.check_file_exists({\n                //     // 'mdl_file_id': $(\"input[name=nameGoesHere]\").val();\n                //     'mdl_file_id': $(this).find('input[name=mdl_file_id]').val()\n\n                // }).then(function (response) {\n                //     // if the text is disabled then use select\n                //     console.log(\"What is the response: \", response);\n                //     var this_form = $('#pu_file_form_'+response.data.record);\n                //     // Convert all the form elements values to a serialised string.\n                //     this_form.append('<input type=\"hidden\" name=\"action\" value=\"copy\" />');\n                //     this_form.submit();\n\n                // });\n            });\n        },\n        /**\n         * Register click events for the page.\n         *\n         * @param null\n         * @return void\n         */\n        registerEvents: function () {\n            // --------------------------------\n            // Copy File.\n            // --------------------------------\n            var that = this;\n            $('.block_pu_container .pu_file_copy').on('click', function(ev) {\n                ev.preventDefault();\n\n                var row_data = {\n                    \"record\": $(this).closest(\"tr\").data(\"rowid\"),\n                    \"this_form\": $(this).closest(\"form\"),\n                    \"title\": 'Copy File',\n                    \"body\": 'Copy and move file to location in settings?',\n                    \"save_button\": \"Copy\",\n                    \"mfileid\": $(this).closest(\"tr\").find('input[name=mdl_file_id]').val()\n                };\n\n                that.confirmCheckExecute(row_data);\n            });\n\n            // --------------------------------\n            // Copy File.\n            // --------------------------------\n            // $('.block_pu_container .pu_file_copy').on('click', function(ev) {\n            //     ev.preventDefault();\n            //     var record = $(this).closest(\"tr\").data(\"rowid\"),\n            //         send_this = {\n            //             \"sentaction\": \"update\",\n            //             \"sentdata\": record,\n            //             \"vform\": \"1\"\n            //         },\n            //         url = sessionStorage.getItem(\"wwwroot\") + \"/blocks/lsuxe/\" + sessionStorage.getItem(\"xe_form\") + \".php\";\n            //     console.log(\"Copy button CLICKED -> What is the record: \", record);\n            //     XELib.pushPost(url, send_this);\n            // });\n\n            // --------------------------------\n            // Delete Mapping.\n            // --------------------------------\n            $('.block_pu_container .pu_file_delete').on('click', function(ev) {\n                ev.preventDefault();\n\n                // var links = $(this).closest(\"tr\").data(\"mlinks\"),\n                var row_data = {\n                    \"record\": $(this).closest(\"tr\").data(\"rowid\"),\n                    \"this_form\": $(this).closest(\"form\"),\n                    \"title\": 'Copy file to folder',\n                    \"body\": 'Ready to copy this file to the folder set in settings?',\n                    \"save_button\": \"Copy File\"\n                };\n\n                // if (links > 1) {\n                //     noti.callAlert({\n                //         \"title\": \"Aborted\",\n                //         \"message\": \"Cannot delete this while mappings are linked.\"\n                //     });\n                // } else {\n                    noti.callYesNoModi(row_data).then(function (response) {\n                        if (response.status == true) {\n                            var this_form = $('#pu_file_form_' + response.data.record);\n                            // Convert all the form elements values to a serialised string.\n                            this_form.append('<input type=\"hidden\" name=\"action\" value=\"copy\" />');\n                            this_form.submit();\n                        }\n                    });\n                // }\n            });\n        },\n\n        /**\n         * Currently this is being called from the mustache templates when viewing lists.\n         * @param null\n         * @return void\n         */\n        init: function() {\n            var that = this;\n            // Register events.\n            that.registerEvents();\n        },\n    };\n});"],"mappings":"AAwBCA,OAAM,8BAAC,CAAC,QAAQ,CAAE,wBAAwB,CAAE,iBAAiB,CAAC,CAC3D,SAASC,CAAC,CAAEC,CAAI,CAAEC,CAAK,CAAE,CACzB,YAAY,CACZ,MAAO,CAMHC,iBAAiB,CAAE,SAAAA,kBAAUC,CAAM,CAAE,CACjC,MAAO,CAAAF,CAAK,CAACG,WAAW,CAAC,CACrBC,IAAA,CAAQ,mBAAmB,CAC3BF,MAAA,CAAUA,CAAM,CAChBG,KAAA,CAAS,QACb,CAAC,CACL,CAAC,CAGDC,mBAAmB,CAAE,SAAAA,oBAAUJ,CAAM,CAAE,CAEnCK,OAAO,CAACC,GAAG,CAAC,uBAAuB,CAAEN,CAAM,CAAC,CAC5CH,CAAI,CAACU,aAAa,CAACP,CAAM,CAAC,CAACQ,IAAI,CAAC,SAAUC,CAAQ,CAAE,CAEhDJ,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAC,CAC9B,GAAI,IAAAG,CAAQ,CAACC,MAAc,CAAE,CAKzB,MAAO,CAAAD,CACX,CACJ,CAAC,CAAC,CAACD,IAAI,CAAC,SAAUC,CAAQ,CAAE,CAExBJ,OAAO,CAACC,GAAG,CAAC,6BAA6B,CAAEG,CAAQ,CAAC,CACpDX,CAAK,CAACa,OAAO,EAkBjB,CAAC,CACL,CAAC,CAODC,cAAc,CAAE,SAAAA,eAAA,CAAY,CAKxBhB,CAAC,CAAC,mCAAmC,CAAC,CAACiB,EAAE,CAAC,OAAO,CAAE,SAASC,CAAE,CAAE,CAC5DA,CAAE,CAACC,cAAc,EAAE,CAEnB,GAAI,CAAAC,CAAQ,CAAG,CACXC,MAAA,CAAUrB,CAAC,CAAC,IAAI,CAAC,CAACsB,OAAO,CAAC,IAAI,CAAC,CAACC,IAAI,CAAC,OAAO,CAAC,CAC7CC,SAAA,CAAaxB,CAAC,CAAC,IAAI,CAAC,CAACsB,OAAO,CAAC,MAAM,CAAC,CACpCG,KAAA,CAAS,WAAW,CACpBC,IAAA,CAAQ,6CAA6C,CACrDC,WAAA,CAAe,MAAM,CACrBC,OAAA,CAAW5B,CAAC,CAAC,IAAI,CAAC,CAACsB,OAAO,CAAC,IAAI,CAAC,CAACO,IAAI,CAAC,yBAAyB,CAAC,CAACC,GAAG,EACxE,CAAC,CAXM,IAAI,CAaNtB,mBAAmB,CAACY,CAAQ,CACrC,CAAC,CAAC,CAqBFpB,CAAC,CAAC,qCAAqC,CAAC,CAACiB,EAAE,CAAC,OAAO,CAAE,SAASC,CAAE,CAAE,CAC9DA,CAAE,CAACC,cAAc,EAAE,CAGnB,GAAI,CAAAC,CAAQ,CAAG,CACXC,MAAA,CAAUrB,CAAC,CAAC,IAAI,CAAC,CAACsB,OAAO,CAAC,IAAI,CAAC,CAACC,IAAI,CAAC,OAAO,CAAC,CAC7CC,SAAA,CAAaxB,CAAC,CAAC,IAAI,CAAC,CAACsB,OAAO,CAAC,MAAM,CAAC,CACpCG,KAAA,CAAS,qBAAqB,CAC9BC,IAAA,CAAQ,wDAAwD,CAChEC,WAAA,CAAe,WACnB,CAAC,CAQG1B,CAAI,CAACU,aAAa,CAACS,CAAQ,CAAC,CAACR,IAAI,CAAC,SAAUC,CAAQ,CAAE,CAClD,GAAI,IAAAA,CAAQ,CAACC,MAAc,CAAE,CACzB,GAAI,CAAAU,CAAS,CAAGxB,CAAC,CAAC,gBAAgB,CAAGa,CAAQ,CAACU,IAAI,CAACF,MAAM,CAAC,CAE1DG,CAAS,CAACO,MAAM,CAAC,0DAAoD,CAAC,CACtEP,CAAS,CAACQ,MAAM,EACpB,CACJ,CAAC,CAET,CAAC,CACL,CAAC,CAODC,IAAI,CAAE,SAAAA,KAAA,CAAW,CACF,IAAI,CAEVjB,cAAc,EACvB,CACJ,CACJ,CAAC,CAAC"}