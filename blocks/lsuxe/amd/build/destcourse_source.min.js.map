{"version":3,"file":"destcourse_source.min.js","names":["define","$","Ajax","Noti","XELib","getGroups","c","v","params","type","url","sessionStorage","getItem","data","wstoken","wsfunction","courseid","moodlewsrestformat","jaxyRemotePromise","processSelected","course_shortname","course_value","selector","length","label","value","split","onSelected","getCourses","criterianame","criteriavalue","val","processResults","results","success","msg","callNoti","message","courses","options","each","index","push","id","shortname","transport","query","callback","then","catch"],"sources":["../src/destcourse_source.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Cross Enrollment Tool\n *\n * @package   block_lsuxe\n * @copyright 2008 onwards Louisiana State University\n * @copyright 2008 onwards David Lowe, Robert Russo\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'block_lsuxe/notifications', 'block_lsuxe/xe_lib'],\n    function($, Ajax, Noti, XELib) {\n    'use strict';\n    return {\n        /**\n         * Make an ajax call to the destination server and get groups.\n         * This is currently not being used but may in the future?\n         *\n         * @param {Object} all the options to use jquery's $.ajax function (not moodle's)\n         * @return {Promise}\n         */\n         getGroups: function (c, v) {\n            var params = {\n                'type': 'GET',\n                'url': sessionStorage.getItem(\"currentUrl\") + '/webservice/rest/server.php',\n                'data': {\n                    'wstoken': sessionStorage.getItem(\"currentToken\"),\n                    'wsfunction': 'core_group_get_course_user_groups',\n                    'courseid': v,\n                    'moodlewsrestformat': 'json'\n                }\n            };\n            return XELib.jaxyRemotePromise(params);\n        },\n\n        processSelected: function (params) {\n            var course_shortname = \"\",\n                course_value = \"\";\n\n            // Handle multiple select results\n            if (params.selector.length > 1) {\n                // TODO: process multiple selects.\n                return;\n            } else if (params.selector.length == 1) {\n                course_shortname = params.selector[0].label;\n                course_value = (params.selector[0].value).split(\"__\")[0];\n                this.getGroups(course_shortname, course_value);\n                // Here a function can be called to make whatever changes AFTER something\n                // has been selected.\n            } else {\n                // Nothing selected.\n                return;\n            }\n        },\n\n        /**\n         * This is a mod that worked but not used. If to be used in the future then\n         * in lib/amd/src/form-autocomplete.js approx ln. 743 need to inject a call to onSelected\n         * when either mouse is clicked or enter key is hit (ln 870)\n         * See the file for details.\n         * lib/amd/src/form-cohort-selector.js also needs to add the onSelected method.\n         * See the file for details.\n         *\n         * This is currently not being used but may in the future?\n         *\n         * @param {Object} all the options to use jquery's $.ajax function (not moodle's)\n         * @return {Promise}\n         */\n        onSelected: function (selector, data) {\n            this.processSelected({'selector': selector, 'data': data});\n        },\n\n        /**\n         * Make an ajax call to the destination server and get courses.\n         *\n         * @param {Object} all the options to use jquery's $.ajax function (not moodle's)\n         * @return {Promise}\n         */\n         getCourses: function (params) {\n            var params = {\n                'type': 'GET',\n                'url': sessionStorage.getItem(\"currentUrl\") + '/webservice/rest/server.php',\n                'data': {\n                    'wstoken': sessionStorage.getItem(\"currentToken\"),\n                    'wsfunction': 'core_course_search_courses',\n                    \"criterianame\": 'search',\n                    'criteriavalue': $('.xe_dest_sn_wrap input').val(),\n                    'moodlewsrestformat': 'json'\n                }\n            };\n            return XELib.jaxyRemotePromise(params);\n         },\n\n        /**\n         * Process the results for auto complete elements. To keep the course id\n         * and name they have been concatenated as the value.\n         *\n         * @param {String} selector The selector of the auto complete element.\n         * @param {Array} results An array or results.\n         * @return {Array} New array of results.\n         */\n        processResults: function(selector, results) {\n            if ('success' in results && results.success == false) {\n                if (results.msg == \"Could not connect to the server.\") {\n                    // Don't show more than one notice, it's annoying.\n                    Noti.callNoti({\n                        message: results.msg,\n                        type: 'error'\n                    });\n                    return;\n                }\n            } else if (results.courses.length > 0) {\n\n                var options = [];\n                $.each(results.courses, function(index, data) {\n                    options.push({\n                        value: data.id + '__' + data.shortname,\n                        label: data.shortname\n                    });\n                });\n                return options;\n            }\n\n            Noti.callNoti({\n                message: \"Sorry, can't seem to reach anything at the moment, please contact the Moodle Dev team.\",\n                type: 'error'\n            });\n        },\n\n        /**\n         * This is using a subclass of Moodle's autocomplete function in:\n         * classes/form/groupform_autocomplete.php\n         *\n         * @param {String} selector The selector of the auto complete element.\n         * @param {String} query The query string.\n         * @param {Function} callback A callback function receiving an array of results.\n         */\n        /* eslint-disable promise/no-callback-in-promise */\n        transport: function(selector, query, callback) {\n            this.getCourses().then(callback).catch();\n            // this calls processResults when done.\n        }\n    };\n\n});\n"],"mappings":"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"}