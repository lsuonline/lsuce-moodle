{"version":3,"sources":["../src/xe_lib.js"],"names":["define","$","jaxy","preLoadConfig","console","log","window_stat","window","__SERVER__","__INITIAL_STATE__","JSON","parse","error","key","subkey_list","subkey","sessionStorage","setItem","pushPost","redirectUrl","data","input_part","form_part","form","value","append","submit","testWebServices","params","jaxyRemotePromise","getTokenForURL","url","jaxyPromise","isValidUrl","urlString","test","promiseObj","Promise","resolve","XEAjax","stringify","then","response","XERemoteAjax"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Cross Enrollment Tool\n *\n * @package    block_lsuxe\n * @copyright  2008 onwards Louisiana State University\n * @copyright  2008 onwards David Lowe\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'block_lsuxe/jaxy'],\n    function($, jaxy) {\n    'use strict';\n    return {\n\n        /**\n         * Store data in sessionStorage so it's available throughout\n         *\n         * @param {object} the json object to save\n         * @return null\n         */\n        preLoadConfig: function() {\n            console.log(\"preLoadConfig() -> START ----------------------\");\n            var window_stat = {};\n\n            if (window.__SERVER__ === \"true\" || window.__SERVER__ === true) {\n                if (typeof (window.__INITIAL_STATE__) === 'string') {\n                    try {\n                        window_stat = JSON.parse(window.__INITIAL_STATE__);\n                        delete window.__INITIAL_STATE__;\n                        window.__SERVER__ = false;\n                    } catch (error) {\n                        console.log(error);\n                    }\n                }\n            } else {\n                console.log(\"WARNING: window.__SERVER__ was not set\");\n            }\n            for (var key in window_stat) {\n                // If typeof yourVariable === 'object', it's an object or null.\n                if (typeof(window_stat[key]) === 'object') {\n                    console.log(\"YESSSSSSSS key is array\");\n                    let subkey_list = window_stat[key];\n                    for (var subkey in subkey_list) {\n                        sessionStorage.setItem(subkey, subkey_list[subkey]);\n                    }\n                } else {\n                    console.log(\"Nope key is val, store it\");\n                    sessionStorage.setItem(key, window_stat[key]);\n                }\n            }\n        },\n\n        /**\n         * Post data to a URL. This is a form submit and will cause a page reload POSTing data.\n         *\n         * @param {string} redirectUrl to post to, self if nothing passed.\n         * @param {object} the json object to post\n         * @return {Promise}\n         */\n        pushPost: function(redirectUrl, data) {\n\n            var input_part = '',\n                form_part = '',\n                form;\n\n            for (var key in data) {\n                var value = data[key];\n                input_part += '<input type=\"hidden\" value=\"' + value + '\" name=\"' + key + '\"></input>';\n            }\n\n            form_part = '<form method=\"POST\" style=\"display: none;\">' + input_part + '</form>';\n            form = $(form_part);\n            $('body').append(form);\n            $(form).submit();\n        },\n\n        /**\n         * Build the select on a form. (INCOMPLETE)\n         *\n         * @param {string} token\n         * @return {Promise}\n         *\n        buildSelect: function (data) {\n\n            var options = [];\n            $.each(results, function(index, data) {\n                options.push({\n                    value: data.id + '__' + data.shortname,\n                    label: data.shortname\n                });\n            });\n            return options;\n        }/\n\n        /**\n         * Get the token for the current selected URL\n         *\n         * @param {string} token\n         * @return {Promise}\n         */\n        testWebServices: function (params) {\n            // lsut/ 333cbddcab2ada64d9e8ca0ec49c6414\n            return this.jaxyRemotePromise(params);\n        },\n\n        /**\n         * Get the token for the current selected URL\n         *\n         * @param {string} token\n         * @return {Promise}\n         */\n        getTokenForURL: function (url) {\n            return this.jaxyPromise({\n                'call': 'getToken',\n                'params': {\n                    'url': url\n                },\n                'class': 'router'\n            });\n        },\n\n        isValidUrl: function (urlString) {\n            var urlPattern = new RegExp('^(https?:\\\\/\\\\/)?'+ // validate protocol\n            '((([a-z\\\\d]([a-z\\\\d-]*[a-z\\\\d])*)\\\\.)+[a-z]{2,}|'+ // validate domain name\n            '((\\\\d{1,3}\\\\.){3}\\\\d{1,3}))'+ // validate OR ip (v4) address\n            '(\\\\:\\\\d+)?(\\\\/[-a-z\\\\d%_.~+]*)*'+ // validate port and path\n            '(\\\\?[;&a-z\\\\d%_.~+=-]*)?'+ // validate query string\n            '(\\\\#[-a-z\\\\d_]*)?$','i'); // validate fragment locator\n            return !!urlPattern.test(urlString);\n        },\n\n        /* ====================================================================== */\n        /* ===================      AJAX Functions      ========================= */\n        /* ====================================================================== */\n        /** Make an AJAX call and return a json object, from server,\n         *  wrapping the AJAX call in a promise.\n         * @param - {object} the details of the ajax call\n         * @return {Promise}\n         */\n        jaxyPromise: function (data) {\n            var promiseObj = new Promise(function (resolve) {\n                jaxy.XEAjax(JSON.stringify(data)).then(function (response) {\n                    resolve(response);\n                });\n            });\n            return promiseObj;\n        },\n\n        /** Make an AJAX call and return a json object, from REMOTE server,\n         *  wrapping the AJAX call in a promise.\n         * @param - {object} the details of the ajax call\n         * @return {Promise}\n         */\n        jaxyRemotePromise: function (data) {\n            console.log(\"jaxyRemotePromise() -> what is data to send: \", data);\n            var promiseObj = new Promise(function (resolve) {\n                jaxy.XERemoteAjax(data).then(function (response) {\n                    console.log(\"jaxyRemotePromise() -> What is the response: \", response);\n                    resolve(response);\n                });\n            });\n            return promiseObj;\n        },\n    };\n});"],"file":"xe_lib.min.js"}