YUI.add("moodle-availability_password-popup",function(c,i){var t="#region-main",o=".availability_password-popup",d="#availability_password_input",p="#availability_password_error",u=".activity",v=".instancename",a=".activityicon";M.availability_password=M.availability_password||{},M.availability_password.popup={api:M.cfg.wwwroot+"/availability/condition/password/ajax.php",init:function(){var i;(i=c.one(t))&&(i.delegate("click",this.showPopup,o,this),i.delegate("click",this.checkShowPopup,u+" "+v,this),i.delegate("click",this.checkShowPopup,u+" "+a,this),this.initActivityLinks())},showPopup:function(i){var t,a,o,e,n,s,r,l;i.preventDefault(),i.stopPropagation(),e=i.currentTarget.get("href"),(n=(n=e.match(/id=(\d+)/))&&parseInt(n[1],10))&&(a="",(s=i.currentTarget.ancestor(u))&&(r=s.one(v))&&(a=r.getHTML()),t="",t+='<div id="availability_password_intro">'+M.util.get_string("passwordintro","availability_password",a)+"</div>",t+='<div class="form-group">',t+='<label class="form-control-label" for="availability_password_input">'+M.util.get_string("enterpassword","availability_password")+"</label>",t+='<input id="availability_password_input" class="form-control" type="password" />',t+='<div id="availability_password_error" class="invalid-feedback" style="display: none; "></div>',t+="</div>",(o=new M.core.dialogue({headerContent:M.util.get_string("passwordprotection","availability_password",a),bodyContent:t,width:"350px",modal:!0}).show()).after("visibleChange",function(){o.get("visible")||o.destroy(!0)}),l=function(i){var t,a;i.preventDefault(),0!==(a=c.one(d).get("value").trim()).length&&(t={sesskey:M.cfg.sesskey,id:n,password:a},c.io(this.api,{data:t,on:{success:function(i,t){var a;try{a=JSON.parse(t.responseText)}catch(o){return void window.alert("Communication error")}a.error?window.alert(a.error):a.success?a.redirect!==undefined?document.location=a.redirect:document.location.reload():(c.one(p).setHTML(M.util.get_string("wrongpassword","availability_password")),c.one(p).show(),c.one(d).addClass("is-invalid"),c.one(d).focus())}}}))},o.addButton({label:M.util.get_string("submit","core"),section:c.WidgetStdMod.FOOTER,action:l,context:this}),o.addButton({label:M.util.get_string("cancel","core"),section:c.WidgetStdMod.FOOTER,action:function(i){i.preventDefault(),o.hide()}}),c.one(d).focus().on("key",l,"enter",this))},checkShowPopup:function(i){var t,a;(t=i.currentTarget).ancestor("a")||(a=t.ancestor(u).one(o))&&(i.preventDefault(),i.stopPropagation(),this.showPopup({currentTarget:a,preventDefault:function(){},stopPropagation:function(){}}))},initActivityLinks:function(){var i=u+" "+v+", "+u+" "+a;c.one(t).all(i).each(function(i){i.ancestor("a")||i.ancestor(u).one(o)&&i.setStyle("cursor","pointer")})}}},"@VERSION@",{requires:["base","node","event","moodle-core-notification-dialogue","io-base"]});