{"version":3,"sources":["../src/segment-lazy.js"],"names":["define","$","Log","self","tracker","options","addAnalyticsJS","dfd","Deferred","writeKey","trackerInfo","debug","analytics","window","initialize","invoked","console","error","methods","factory","t","e","Array","prototype","slice","call","arguments","unshift","push","length","load","n","document","createElement","type","async","src","a","getElementsByTagName","parentNode","insertBefore","_loadOptions","SNIPPET_VERSION","resolve","loadTracker","identify","staticShares","userHash","trackPage","page","processEvent","metricName","data","track","eventData"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Loads Segment tracker.\n *\n * @package   local_liquidus\n * @copyright Copyright (c) 2020 Open LMS\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery','core/log'],\nfunction($, Log) {\n\n    var self = this;\n\n    var tracker = {};\n\n    var options = {};\n\n    self.addAnalyticsJS = function() {\n        var dfd = $.Deferred();\n        var writeKey = tracker.trackerInfo.writeKey;\n        if (!writeKey) {\n            Log.debug('Liquidus is misconfigured for Segment, Write Key is missing.');\n            return;\n        }\n        /* eslint-disable */\n        !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error(\"Segment snippet included twice.\");else{analytics.invoked=!0;analytics.methods=[\"trackSubmit\",\"trackClick\",\"trackLink\",\"trackForm\",\"pageview\",\"identify\",\"reset\",\"group\",\"track\",\"ready\",\"alias\",\"debug\",\"page\",\"once\",\"off\",\"on\"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t,e){var n=document.createElement(\"script\");n.type=\"text/javascript\";n.async=!0;n.src=\"https://cdn.segment.com/analytics.js/v1/\"+t+\"/analytics.min.js\";var a=document.getElementsByTagName(\"script\")[0];a.parentNode.insertBefore(n,a);analytics._loadOptions=e};analytics.SNIPPET_VERSION=\"4.1.0\";\n            self.analytics = analytics;\n            analytics.load(writeKey);\n            dfd.resolve(tracker);\n        }}();\n        /* eslint-enable */\n        return dfd;\n    };\n\n    tracker.loadTracker = function(trackerInfo) {\n        tracker.trackerInfo = trackerInfo;\n        return self.addAnalyticsJS();\n    };\n\n    tracker.identify = function() {\n        Log.debug('Identifying with segment');\n        self.analytics.identify(tracker.trackerInfo.staticShares.userHash, tracker.trackerInfo.staticShares);\n    };\n\n    tracker.trackPage = function() {\n        self.analytics.page();\n    };\n\n    tracker.processEvent = function(dfd, metricName, data) {\n        self.analytics.track(metricName, {\n            userHash: tracker.trackerInfo.staticShares.userHash,\n            eventData: data\n        }, options, function() {\n            dfd.resolve(true);\n            Log.debug('Segment resolved.');\n        });\n    };\n\n    return tracker;\n});\n"],"file":"segment-lazy.min.js"}