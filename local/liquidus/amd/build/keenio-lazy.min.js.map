{"version":3,"sources":["../src/keenio-lazy.js"],"names":["define","$","Log","self","tracker","addKeenIO","dfd","Deferred","writeKey","trackerInfo","projectId","debug","name","path","ctx","latest","prev","window","Keen","ready","fn","h","document","getElementsByTagName","s","createElement","w","loaded","onload","onerror","onreadystatechange","readyState","test","e","async","src","parentNode","insertBefore","KeenAsync","client","resolve","loadTracker","identify","recordEvent","userHash","staticShares","trackPage","processEvent","metricName","data","eventData"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Loads Segment tracker.\n *\n * @package   local_liquidus\n * @copyright Copyright (c) 2020 Open LMS\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery','core/log'],\nfunction($, Log) {\n\n    var self = this;\n\n    var tracker = {};\n\n    self.addKeenIO = function() {\n        var dfd = $.Deferred();\n        var writeKey = tracker.trackerInfo.writeKey, projectId = tracker.trackerInfo.projectId;\n        if (!writeKey || !projectId) {\n            Log.debug('Liquidus is misconfigured for keen.io, Write Key or Project ID are missing.');\n            return;\n        }\n        /* eslint-disable */\n        (function(name,path,ctx){var latest,prev=name!=='Keen'&&window.Keen?window.Keen:false;ctx[name]=ctx[name]||{ready:function(fn){var h=document.getElementsByTagName('head')[0],s=document.createElement('script'),w=window,loaded;s.onload=s.onerror=s.onreadystatechange=function(){if((s.readyState&&!(/^c|loade/.test(s.readyState)))||loaded){return}s.onload=s.onreadystatechange=null;loaded=1;latest=w.Keen;if(prev){w.Keen=prev}else{try{delete w.Keen}catch(e){w.Keen=void 0}}ctx[name]=latest;ctx[name].ready(fn)};s.async=1;s.src=path;h.parentNode.insertBefore(s,h)}}\n        })('KeenAsync','https://d26b395fwzu5fz.cloudfront.net/keen-tracking-1.4.2.min.js',this);\n\n        KeenAsync.ready(function(){\n            self.client = new KeenAsync({\n                projectId: projectId,\n                writeKey: writeKey\n            });\n            dfd.resolve(tracker);\n        });\n        /* eslint-enable */\n        return dfd;\n    };\n\n    tracker.loadTracker = function(trackerInfo) {\n        tracker.trackerInfo = trackerInfo;\n        return self.addKeenIO();\n    };\n\n    tracker.identify = function() {\n        self.client.recordEvent('identify', {\n            userHash: tracker.trackerInfo.staticShares.userHash\n        });\n    };\n\n    tracker.trackPage = function() {\n        self.client.recordEvent('pageviews', tracker.trackerInfo.staticShares);\n    };\n\n    tracker.processEvent = function(dfd, metricName, data) {\n        self.client.recordEvent(metricName, {\n            userHash: tracker.trackerInfo.staticShares.userHash,\n            eventData: data,\n        }, function() {\n            dfd.resolve(true);\n            Log.debug('KeenIO resolved.');\n        });\n    };\n\n    return tracker;\n});\n"],"file":"keenio-lazy.min.js"}