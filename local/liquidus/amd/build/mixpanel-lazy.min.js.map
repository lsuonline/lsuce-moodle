{"version":3,"sources":["../src/mixpanel-lazy.js"],"names":["define","$","Log","self","tracker","addAnalyticsJS","dfd","Deferred","token","trackerInfo","debug","f","b","__SV","e","g","i","h","window","mixpanel","_i","init","c","a","d","split","length","push","concat","Array","prototype","slice","call","arguments","people","toString","j","get_group","call2_args","call2","createElement","type","async","src","MIXPANEL_CUSTOM_LIB_URL","location","protocol","match","getElementsByTagName","parentNode","insertBefore","document","trackforms","trackForms","resolve","pageType","staticShares","each","index","currentForm","id","attr","track_forms","loadTracker","identify","userHash","trackPage","data","plugins","Object","entries","forEach","value","pagetypeevent","eventId","track","processEvent","metricName","send_immediately"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Loads Mixpanel tracker.\n *\n * @package   local_liquidus\n * @copyright Copyright (c) 2021 Open LMS\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery','core/log'],\n    function($, Log) {\n\n        var self = this;\n\n        var tracker = {};\n\n        self.addAnalyticsJS = function() {\n            var dfd = $.Deferred();\n            var token = tracker.trackerInfo.token;\n            if (!token) {\n                Log.debug('Liquidus is misconfigured for Mixpanel, Token is missing.');\n                return;\n            }\n            /* eslint-disable */\n            (function(f,b){if(!b.__SV){var e,g,i,h;window.mixpanel=b;b._i=[];b.init=function(e,f,c){function g(a,d){var b=d.split(\".\");2==b.length&&(a=a[b[0]],d=b[1]);a[d]=function(){a.push([d].concat(Array.prototype.slice.call(arguments,0)))}}var a=b;\"undefined\"!==typeof c?a=b[c]=[]:c=\"mixpanel\";a.people=a.people||[];a.toString=function(a){var d=\"mixpanel\";\"mixpanel\"!==c&&(d+=\".\"+c);a||(d+=\" (stub)\");return d};a.people.toString=function(){return a.toString(1)+\".people (stub)\"};i=\"disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove\".split(\" \");\n            for(h=0;h<i.length;h++)g(a,i[h]);var j=\"set set_once union unset remove delete\".split(\" \");a.get_group=function(){function b(c){d[c]=function(){call2_args=arguments;call2=[c].concat(Array.prototype.slice.call(call2_args,0));a.push([e,call2])}}for(var d={},e=[\"get_group\"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<j.length;c++)b(j[c]);return d};b._i.push([e,f,c])};b.__SV=1.2;e=f.createElement(\"script\");e.type=\"text/javascript\";e.async=!0;e.src=\"undefined\"!==typeof MIXPANEL_CUSTOM_LIB_URL?\n            MIXPANEL_CUSTOM_LIB_URL:\"file:\"===f.location.protocol&&\"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js\".match(/^\\/\\//)?\"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js\":\"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js\";g=f.getElementsByTagName(\"script\")[0];g.parentNode.insertBefore(e,g)}})(document,window.mixpanel||[]);\n            mixpanel.init(token);\n            /* eslint-enable */\n\n            if (typeof tracker.trackerInfo.trackforms !== 'undefined'\n                && tracker.trackerInfo.trackforms) {\n                trackForms();\n            }\n\n            dfd.resolve(tracker);\n            return dfd;\n        };\n\n        const trackForms = () => {\n            const pageType = typeof tracker.trackerInfo.staticShares.pageType != 'undefined' ?\n                tracker.trackerInfo.staticShares.pageType + '_' : '';\n\n            $('form').each(function(index) {\n                const currentForm = $(this);\n\n                let id = currentForm.attr('id');\n                if (typeof id === 'undefined') {\n                    id = currentForm.attr('name');\n                }\n\n                if (typeof id === 'undefined') {\n                    id = index;\n                } else {\n                    id = index + '_' + id;\n                }\n\n                id = pageType + id;\n\n                /* global mixpanel */\n                mixpanel.track_forms(currentForm, 'Form submitted - ' + id);\n            });\n        };\n\n        tracker.loadTracker = function(trackerInfo) {\n            tracker.trackerInfo = trackerInfo;\n            return self.addAnalyticsJS();\n        };\n\n        tracker.identify = function() {\n            /* global mixpanel */\n            mixpanel.identify(tracker.trackerInfo.staticShares.userHash);\n        };\n\n        tracker.trackPage = function() {\n            let data = {};\n            if (tracker.trackerInfo.staticShares.plugins) {\n                const plugins = tracker.trackerInfo.staticShares.plugins;\n                Object.entries(plugins).forEach(\n                    ([type, value]) => {\n                        // Dynamically adding property names.\n                        data['PluginsUsed_' + type] = value;\n                    });\n                delete tracker.trackerInfo.staticShares.plugins;\n            }\n            Object.entries(tracker.trackerInfo.staticShares).forEach(\n                ([type, value]) => {\n                    if (type === 'pageType'\n                        && typeof tracker.trackerInfo.pagetypeevent != 'undefined'\n                        && tracker.trackerInfo.pagetypeevent\n                    ) {\n                        return; // Page type will be appended to page event.\n                    }\n                    data[type] = value;\n                }\n            );\n            let eventId = 'Page view';\n            if (typeof tracker.trackerInfo.pagetypeevent != 'undefined'\n                && tracker.trackerInfo.pagetypeevent\n                && typeof tracker.trackerInfo.staticShares.pageType != 'undefined'\n            ) {\n                eventId += ' - ' + tracker.trackerInfo.staticShares.pageType;\n            }\n            /* global mixpanel */\n            mixpanel.track(eventId, data);\n        };\n\n        tracker.processEvent = function(dfd, metricName, data) {\n            /* global mixpanel */\n            mixpanel.track(metricName, data, {send_immediately: true}, () => {\n                dfd.resolve();\n                Log.debug('[mixpanel] Sent custom event.');\n            });\n        };\n\n        return tracker;\n    });\n"],"file":"mixpanel-lazy.min.js"}