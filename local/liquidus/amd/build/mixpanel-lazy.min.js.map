{"version":3,"sources":["../src/mixpanel-lazy.js"],"names":["define","$","Log","self","tracker","addAnalyticsJS","dfd","Deferred","token","trackerInfo","debug","c","a","__SV","b","window","d","m","j","k","location","f","hash","match","RegExp","JSON","parse","decodeURIComponent","action","sessionStorage","setItem","history","replaceState","desiredHash","title","pathname","search","n","l","h","mixpanel","_i","init","g","i","split","length","push","concat","Array","prototype","slice","call","arguments","e","people","toString","get_group","call2_args","call2","createElement","type","async","src","MIXPANEL_CUSTOM_LIB_URL","protocol","getElementsByTagName","parentNode","insertBefore","document","batch_requests","analytics","resolve","loadTracker","identify","staticShares","userHash","trackPage","data","plugins","Object","entries","forEach","value","track","processEvent","metricName","eventData"],"mappings":"+qCAsBAA,OAAM,gCAAC,CAAC,QAAD,CAAU,UAAV,CAAD,CACF,SAASC,CAAT,CAAYC,CAAZ,CAAiB,IAETC,CAAAA,CAAI,CAAG,IAFE,CAITC,CAAO,CAAG,EAJD,CAMbD,CAAI,CAACE,cAAL,CAAsB,UAAW,IACzBC,CAAAA,CAAG,CAAGL,CAAC,CAACM,QAAF,EADmB,CAEzBC,CAAK,CAAGJ,CAAO,CAACK,WAAR,CAAoBD,KAFH,CAG7B,GAAI,CAACA,CAAL,CAAY,CACRN,CAAG,CAACQ,KAAJ,CAAU,2DAAV,EACA,MACH,CAED,CAAC,SAASC,CAAT,CAAWC,CAAX,CAAa,CAAC,GAAG,CAACA,CAAC,CAACC,IAAN,CAAW,CAAC,GAAIC,CAAAA,CAAC,CAACC,MAAN,CAAa,GAAG,CAAC,GAAIC,CAAAA,CAAJ,CAAMC,CAAN,CAAQC,CAAR,CAAUC,CAAC,CAACL,CAAC,CAACM,QAAd,CAAuBC,CAAC,CAACF,CAAC,CAACG,IAA3B,CAAgCN,CAAC,CAAC,SAASJ,CAAT,CAAWE,CAAX,CAAa,CAAC,MAAM,CAACG,CAAC,CAACL,CAAC,CAACW,KAAF,CAAQC,MAAM,CAACV,CAAC,CAAC,UAAH,CAAd,CAAH,EAAkCG,CAAC,CAAC,CAAD,CAAnC,CAAuC,IAAK,CAAlE,CAAmEI,CAAC,EAAEL,CAAC,CAACK,CAAD,CAAG,OAAH,CAAJ,GAAkBH,CAAC,CAACO,IAAI,CAACC,KAAL,CAAWC,kBAAkB,CAACX,CAAC,CAACK,CAAD,CAAG,OAAH,CAAF,CAA7B,CAAF,CAA+C,aAAaH,CAAC,CAACU,MAAf,GAAwBd,CAAC,CAACe,cAAF,CAAiBC,OAAjB,CAAyB,WAAzB,CAAqCT,CAArC,EAAwCU,OAAO,CAACC,YAAR,CAAqBd,CAAC,CAACe,WAAF,EAAe,EAApC,CAAuCtB,CAAC,CAACuB,KAAzC,CAA+Cf,CAAC,CAACgB,QAAF,CAAWhB,CAAC,CAACiB,MAA5D,CAAhE,CAAjE,CAAuM,OAAMC,CAAN,CAAQ,CAAE,IAAIC,CAAAA,CAAJ,CAAMC,CAAN,CAAQxB,MAAM,CAACyB,QAAP,CAAgB5B,CAAhB,CAAkBA,CAAC,CAAC6B,EAAF,CAAK,EAAL,CAAQ7B,CAAC,CAAC8B,IAAF,CAAO,SAAS5B,CAAT,CAAWE,CAAX,CAAa2B,CAAb,CAAe,CAAC,QAAShC,CAAAA,CAAT,CAAWG,CAAX,CAAa8B,CAAb,CAAe,CAAC,GAAIhC,CAAAA,CAAC,CAACgC,CAAC,CAACC,KAAF,CAAQ,GAAR,CAAN,CAAmB,GAAGjC,CAAC,CAACkC,MAAL,GAAchC,CAAC,CAACA,CAAC,CAACF,CAAC,CAAC,CAAD,CAAF,CAAH,CAAUgC,CAAC,CAAChC,CAAC,CAAC,CAAD,CAA3B,EAAgCE,CAAC,CAAC8B,CAAD,CAAD,CAAK,UAAU,CAAC9B,CAAC,CAACiC,IAAF,CAAO,CAACH,CAAD,EAAII,MAAJ,CAAWC,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2BC,SAA3B,CAC9f,CAD8f,CAAX,CAAP,CACve,CAAC,IAAIC,CAAAA,CAAC,CAAC1C,CAAN,CAAQ,aAAc,MAAO+B,CAAAA,CAArB,CAAuBW,CAAC,CAAC1C,CAAC,CAAC+B,CAAD,CAAD,CAAK,EAA9B,CAAiCA,CAAC,CAAC,UAAnC,CAA8CW,CAAC,CAACC,MAAF,CAASD,CAAC,CAACC,MAAF,EAAU,EAAnB,CAAsBD,CAAC,CAACE,QAAF,CAAW,SAAS1C,CAAT,CAAW,CAAC,GAAIF,CAAAA,CAAC,CAAC,UAAN,CAAiB,aAAa+B,CAAb,GAAiB/B,CAAC,EAAE,IAAI+B,CAAxB,EAA2B7B,CAAC,GAAGF,CAAC,EAAE,SAAN,CAAD,CAAkB,MAAOA,CAAAA,CAAE,CAA9F,CAA+F0C,CAAC,CAACC,MAAF,CAASC,QAAT,CAAkB,UAAU,CAAC,MAAOF,CAAAA,CAAC,CAACE,QAAF,CAAW,CAAX,EAAc,gBAAiB,CAAnE,CAAoElB,CAAC,wgBAAD,CACrP,IAAIC,CAAC,CAAC,CAAN,CAAQA,CAAC,CAACD,CAAC,CAACQ,MAAZ,CAAmBP,CAAC,EAApB,EAAuB5B,CAAC,CAAC2C,CAAD,CAAGhB,CAAC,CAACC,CAAD,CAAJ,CAAxB,CAAiC,GAAIlB,CAAAA,CAAC,qDAAL,CAA0DiC,CAAC,CAACG,SAAF,CAAY,UAAU,CAAC,QAAS7C,CAAAA,CAAT,CAAWD,CAAX,CAAa,CAACG,CAAC,CAACH,CAAD,CAAD,CAAK,UAAU,CAAC+C,UAAU,CAACL,SAAX,CAAqBM,KAAK,CAAC,CAAChD,CAAD,EAAIqC,MAAJ,CAAWC,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2BM,UAA3B,CAAsC,CAAtC,CAAX,CAAN,CAA2DJ,CAAC,CAACP,IAAF,CAAO,CAAC/B,CAAD,CAAG2C,KAAH,CAAP,CAAkB,CAAC,KAAI,GAAI7C,CAAAA,CAAC,CAAC,EAAN,CAASE,CAAC,CAAC,CAAC,WAAD,EAAcgC,MAAd,CAAqBC,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2BC,SAA3B,CAAqC,CAArC,CAArB,CAAX,CAAyE1C,CAAC,CAAC,CAA/E,CAAiFA,CAAC,CAACU,CAAC,CAACyB,MAArF,CAA4FnC,CAAC,EAA7F,EAAgGC,CAAC,CAACS,CAAC,CAACV,CAAD,CAAF,CAAjG,CAAwG,MAAOG,CAAAA,CAAE,CAAzQ,CAA0QF,CAAC,CAAC6B,EAAF,CAAKM,IAAL,CAAU,CAACjC,CAAD,CAAGE,CAAH,CAAK2B,CAAL,CAAV,CAAmB,CAFU,CAET/B,CAAC,CAACC,IAAF,CAAO,GAAP,CAAWC,CAAC,CAACH,CAAC,CAACiD,aAAF,CAAgB,QAAhB,CAAF,CAA4B9C,CAAC,CAAC+C,IAAF,CAAO,iBAAP,CAAyB/C,CAAC,CAACgD,KAAF,CAAQ,CAAC,CAAT,CAAWhD,CAAC,CAACiD,GAAF,CAAM,aAAc,MAAOC,CAAAA,uBAArB,CAC1cA,uBAD0c,CAClb,UAAUrD,CAAC,CAACS,QAAF,CAAW6C,QAArB,EAA+B,gDAAgD1C,KAAhD,CAAsD,OAAtD,CAA/B,CAA8F,qDAA9F,CAAoJ,+CADwR,CACxOP,CAAC,CAACL,CAAC,CAACuD,oBAAF,CAAuB,QAAvB,EAAiC,CAAjC,CAAF,CAAsClD,CAAC,CAACmD,UAAF,CAAaC,YAAb,CAA0BtD,CAA1B,CAA4BE,CAA5B,CAA+B,CAAC,CAHlS,EAGoSqD,QAHpS,CAG6StD,MAAM,CAACyB,QAAP,EAAiB,EAH9T,EAIAA,QAAQ,CAACE,IAAT,CAAclC,CAAd,CAAqB,CAAC8D,cAAc,GAAf,CAArB,EACAnE,CAAI,CAACoE,SAAL,CAAiB/B,QAAjB,CAEAlC,CAAG,CAACkE,OAAJ,CAAYpE,CAAZ,EACA,MAAOE,CAAAA,CACV,CAjBD,CAmBAF,CAAO,CAACqE,WAAR,CAAsB,SAAShE,CAAT,CAAsB,CACxCL,CAAO,CAACK,WAAR,CAAsBA,CAAtB,CACA,MAAON,CAAAA,CAAI,CAACE,cAAL,EACV,CAHD,CAKAD,CAAO,CAACsE,QAAR,CAAmB,UAAW,CAC1BvE,CAAI,CAACoE,SAAL,CAAeG,QAAf,CAAwBtE,CAAO,CAACK,WAAR,CAAoBkE,YAApB,CAAiCC,QAAzD,CACH,CAFD,CAIAxE,CAAO,CAACyE,SAAR,CAAoB,UAAW,CAC3B,GAAIC,CAAAA,CAAI,CAAG,EAAX,CACA,GAAI1E,CAAO,CAACK,WAAR,CAAoBkE,YAApB,CAAiCI,OAArC,CAA8C,CAC1C,GAAMA,CAAAA,CAAO,CAAG3E,CAAO,CAACK,WAAR,CAAoBkE,YAApB,CAAiCI,OAAjD,CACAC,MAAM,CAACC,OAAP,CAAeF,CAAf,EAAwBG,OAAxB,CACI,WAAmB,2BAAjBrB,CAAiB,MAAXsB,CAAW,MAEfL,CAAI,CAAC,eAAiBjB,CAAlB,CAAJ,CAA8BsB,CACjC,CAJL,EAKA,MAAO/E,CAAAA,CAAO,CAACK,WAAR,CAAoBkE,YAApB,CAAiCI,OAC3C,CACDC,MAAM,CAACC,OAAP,CAAe7E,CAAO,CAACK,WAAR,CAAoBkE,YAAnC,EAAiDO,OAAjD,CACI,WAAmB,2BAAjBrB,CAAiB,MAAXsB,CAAW,MACfL,CAAI,CAACjB,CAAD,CAAJ,CAAasB,CAChB,CAHL,EAKAhF,CAAI,CAACoE,SAAL,CAAea,KAAf,CAAqB,WAArB,CAAkCN,CAAlC,CACH,CAjBD,CAmBA1E,CAAO,CAACiF,YAAR,CAAuB,SAAS/E,CAAT,CAAcgF,CAAd,CAA0BR,CAA1B,CAAgC,CACnD3E,CAAI,CAACoE,SAAL,CAAea,KAAf,CAAqBE,CAArB,CAAiC,CAC7BC,SAAS,CAAET,CADkB,CAAjC,CAEG,EAFH,CAEO,UAAW,CACdxE,CAAG,CAACkE,OAAJ,KACAtE,CAAG,CAACQ,KAAJ,CAAU,iCAAV,CACH,CALD,CAMH,CAPD,CASA,MAAON,CAAAA,CACV,CAhEC,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Loads Mixpanel tracker.\n *\n * @package   local_liquidus\n * @copyright Copyright (c) 2021 Open LMS\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery','core/log'],\n    function($, Log) {\n\n        var self = this;\n\n        var tracker = {};\n\n        self.addAnalyticsJS = function() {\n            var dfd = $.Deferred();\n            var token = tracker.trackerInfo.token;\n            if (!token) {\n                Log.debug('Liquidus is misconfigured for Mixpanel, Token is missing.');\n                return;\n            }\n            /* eslint-disable */\n            (function(c,a){if(!a.__SV){var b=window;try{var d,m,j,k=b.location,f=k.hash;d=function(a,b){return(m=a.match(RegExp(b+\"=([^&]*)\")))?m[1]:null};f&&d(f,\"state\")&&(j=JSON.parse(decodeURIComponent(d(f,\"state\"))),\"mpeditor\"===j.action&&(b.sessionStorage.setItem(\"_mpcehash\",f),history.replaceState(j.desiredHash||\"\",c.title,k.pathname+k.search)))}catch(n){}var l,h;window.mixpanel=a;a._i=[];a.init=function(b,d,g){function c(b,i){var a=i.split(\".\");2==a.length&&(b=b[a[0]],i=a[1]);b[i]=function(){b.push([i].concat(Array.prototype.slice.call(arguments,\n            0)))}}var e=a;\"undefined\"!==typeof g?e=a[g]=[]:g=\"mixpanel\";e.people=e.people||[];e.toString=function(b){var a=\"mixpanel\";\"mixpanel\"!==g&&(a+=\".\"+g);b||(a+=\" (stub)\");return a};e.people.toString=function(){return e.toString(1)+\".people (stub)\"};l=\"disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove\".split(\" \");\n            for(h=0;h<l.length;h++)c(e,l[h]);var f=\"set set_once union unset remove delete\".split(\" \");e.get_group=function(){function a(c){b[c]=function(){call2_args=arguments;call2=[c].concat(Array.prototype.slice.call(call2_args,0));e.push([d,call2])}}for(var b={},d=[\"get_group\"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<f.length;c++)a(f[c]);return b};a._i.push([b,d,g])};a.__SV=1.2;b=c.createElement(\"script\");b.type=\"text/javascript\";b.async=!0;b.src=\"undefined\"!==typeof MIXPANEL_CUSTOM_LIB_URL?\n            MIXPANEL_CUSTOM_LIB_URL:\"file:\"===c.location.protocol&&\"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js\".match(/^\\/\\//)?\"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js\":\"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js\";d=c.getElementsByTagName(\"script\")[0];d.parentNode.insertBefore(b,d)}})(document,window.mixpanel||[]);\n            mixpanel.init(token, {batch_requests: true});\n            self.analytics = mixpanel;\n            /* eslint-enable */\n            dfd.resolve(tracker);\n            return dfd;\n        };\n\n        tracker.loadTracker = function(trackerInfo) {\n            tracker.trackerInfo = trackerInfo;\n            return self.addAnalyticsJS();\n        };\n\n        tracker.identify = function() {\n            self.analytics.identify(tracker.trackerInfo.staticShares.userHash);\n        };\n\n        tracker.trackPage = function() {\n            let data = {};\n            if (tracker.trackerInfo.staticShares.plugins) {\n                const plugins = tracker.trackerInfo.staticShares.plugins;\n                Object.entries(plugins).forEach(\n                    ([type, value]) => {\n                        // Dynamically adding property names.\n                        data['PluginsUsed_' + type] = value;\n                    });\n                delete tracker.trackerInfo.staticShares.plugins;\n            }\n            Object.entries(tracker.trackerInfo.staticShares).forEach(\n                ([type, value]) => {\n                    data[type] = value;\n                }\n            );\n            self.analytics.track('Page view', data);\n        };\n\n        tracker.processEvent = function(dfd, metricName, data) {\n            self.analytics.track(metricName, {\n                eventData: data,\n            }, {}, function() {\n                dfd.resolve(true);\n                Log.debug('MixPanel resolved custom event.');\n            });\n        };\n\n        return tracker;\n    });\n"],"file":"mixpanel-lazy.min.js"}