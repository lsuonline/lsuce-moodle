{"version":3,"sources":["../src/appcues-lazy.js"],"names":["define","$","Log","self","tracker","addAnalyticsJS","dfd","Deferred","accountid","trackerInfo","debug","Appcues","fail","analytics","resolve","loadTracker","identify","staticShares","userHash","trackPage","page","data","plugins","Object","entries","forEach","type","value","track","processEvent","metricName"],"mappings":"+qCAsBAA,OAAM,+BAAC,CAAC,QAAD,CAAU,UAAV,CAAD,CACF,SAASC,CAAT,CAAYC,CAAZ,CAAiB,IAETC,CAAAA,CAAI,CAAG,IAFE,CAITC,CAAO,CAAG,EAJD,CAMbD,CAAI,CAACE,cAAL,CAAsB,UAAW,IACvBC,CAAAA,CAAG,CAAGL,CAAC,CAACM,QAAF,EADiB,CAEvBC,CAAS,CAAGJ,CAAO,CAACK,WAAR,CAAoBD,SAFT,CAG7B,GAAI,CAACA,CAAL,CAAgB,CACZN,CAAG,CAACQ,KAAJ,CAAU,+DAAV,EACA,MACH,CAED,GAAuB,WAAnB,QAAOC,CAAAA,OAAX,CAAoC,CAChCL,CAAG,CAACM,IAAJ,GACA,MAAON,CAAAA,CACV,CACDH,CAAI,CAACU,SAAL,CAAiBF,OAAjB,CACAL,CAAG,CAACQ,OAAJ,GACA,MAAOR,CAAAA,CACV,CAfD,CAiBAF,CAAO,CAACW,WAAR,CAAsB,SAASN,CAAT,CAAsB,CACxCL,CAAO,CAACK,WAAR,CAAsBA,CAAtB,CACA,MAAON,CAAAA,CAAI,CAACE,cAAL,EACV,CAHD,CAKAD,CAAO,CAACY,QAAR,CAAmB,UAAW,CAC1Bb,CAAI,CAACU,SAAL,CAAeG,QAAf,CAAwBZ,CAAO,CAACK,WAAR,CAAoBQ,YAApB,CAAiCC,QAAzD,CACH,CAFD,CAIAd,CAAO,CAACe,SAAR,CAAoB,UAAW,CAC3BhB,CAAI,CAACU,SAAL,CAAeO,IAAf,GACA,GAAIC,CAAAA,CAAI,CAAG,EAAX,CACA,GAAIjB,CAAO,CAACK,WAAR,CAAoBQ,YAApB,CAAiCK,OAArC,CAA8C,CAC1C,GAAMA,CAAAA,CAAO,CAAGlB,CAAO,CAACK,WAAR,CAAoBQ,YAApB,CAAiCK,OAAjD,CACAC,MAAM,CAACC,OAAP,CAAeF,CAAf,EAAwBG,OAAxB,CACI,WAAmB,2BAAjBC,CAAiB,MAAXC,CAAW,MAEfN,CAAI,CAAC,eAAiBK,CAAlB,CAAJ,CAA8BC,CACjC,CAJL,EAKA,MAAOvB,CAAAA,CAAO,CAACK,WAAR,CAAoBQ,YAApB,CAAiCK,OAC3C,CACDC,MAAM,CAACC,OAAP,CAAepB,CAAO,CAACK,WAAR,CAAoBQ,YAAnC,EAAiDQ,OAAjD,CACI,WAAmB,2BAAjBC,CAAiB,MAAXC,CAAW,MACfN,CAAI,CAACK,CAAD,CAAJ,CAAaC,CAChB,CAHL,EAKAxB,CAAI,CAACU,SAAL,CAAee,KAAf,CAAqB,WAArB,CAAkCP,CAAlC,CACH,CAlBD,CAoBAjB,CAAO,CAACyB,YAAR,CAAuB,SAASvB,CAAT,CAAcwB,CAAd,CAA0BT,CAA1B,CAAgC,CACnDlB,CAAI,CAACU,SAAL,CAAee,KAAf,CAAqBE,CAArB,CAAiCT,CAAjC,CAEH,CAHD,CAKA,MAAOjB,CAAAA,CACV,CA3DC,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Loads Appcues tracker.\n *\n * @package   local_liquidus\n * @copyright Copyright (c) 2021 Open LMS\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery','core/log'],\n    function($, Log) {\n\n        var self = this;\n\n        var tracker = {};\n\n        self.addAnalyticsJS = function() {\n            const dfd = $.Deferred();\n            const accountid = tracker.trackerInfo.accountid;\n            if (!accountid) {\n                Log.debug('Liquidus is misconfigured for Appcues, Account ID is missing.');\n                return;\n            }\n            /* global Appcues */\n            if (typeof Appcues === 'undefined') {\n                dfd.fail();\n                return dfd;\n            }\n            self.analytics = Appcues;\n            dfd.resolve();\n            return dfd;\n        };\n\n        tracker.loadTracker = function(trackerInfo) {\n            tracker.trackerInfo = trackerInfo;\n            return self.addAnalyticsJS();\n        };\n\n        tracker.identify = function() {\n            self.analytics.identify(tracker.trackerInfo.staticShares.userHash);\n        };\n\n        tracker.trackPage = function() {\n            self.analytics.page();\n            let data = {};\n            if (tracker.trackerInfo.staticShares.plugins) {\n                const plugins = tracker.trackerInfo.staticShares.plugins;\n                Object.entries(plugins).forEach(\n                    ([type, value]) => {\n                        // Dynamically adding property names.\n                        data['PluginsUsed_' + type] = value;\n                    });\n                delete tracker.trackerInfo.staticShares.plugins;\n            }\n            Object.entries(tracker.trackerInfo.staticShares).forEach(\n                ([type, value]) => {\n                    data[type] = value;\n                }\n            );\n            self.analytics.track('Page view', data);\n        };\n\n        tracker.processEvent = function(dfd, metricName, data) {\n            self.analytics.track(metricName, data);\n            // We don't resolve the dfd promise here so we have some time from the API.\n        };\n\n        return tracker;\n    });\n"],"file":"appcues-lazy.min.js"}