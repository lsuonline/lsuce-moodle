{"version":3,"sources":["../src/kinesis-lazy.js"],"names":["define","$","Log","self","tracker","addAnalyticsJS","dfd","Deferred","trackerInfo","kinesisURL","debug","resolve","loadTracker","identify","ajax","url","method","headers","staticShares","done","trackPage","userHash","page","window","location","pathname","split","slice","referrer_page","document","referrer","custom_metric_name","custom_metric_string_value","navigator","userAgent","heartBeat","processEvent","metricName","data","JSON","stringify"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Loads AWS Kinesis tracker.\n *\n * @package   local_liquidus\n * @copyright Copyright (c) 2020 Open LMS\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/log'],\nfunction($, Log) {\n\n    var self = this;\n\n    var tracker = {};\n\n    self.addAnalyticsJS = function() {\n        var dfd = $.Deferred();\n        if (!tracker.trackerInfo.kinesisURL) {\n            Log.debug('Liquidus is misconfigured for AWS Kinesis, Kinesis URL is missing.');\n            return null;\n        }\n\n        dfd.resolve(true);\n\n        return dfd;\n    };\n\n    tracker.loadTracker = function(trackerInfo) {\n        tracker.trackerInfo = trackerInfo;\n        return self.addAnalyticsJS();\n    };\n\n    tracker.identify = function() {\n        $.ajax({\n            url: tracker.trackerInfo.kinesisURL,\n            method: 'POST',\n            headers: tracker.trackerInfo.staticShares\n        }).done(function() {\n            Log.debug('Liquidus identified with kinesis.');\n        });\n    };\n\n    tracker.trackPage = function() {\n        $.ajax({\n            url: tracker.trackerInfo.kinesisURL,\n            method: 'POST',\n            headers: {\n                userHash: tracker.trackerInfo.staticShares.userHash,\n                page: window.location.pathname.split(\"/\").slice(-1),\n                referrer_page: document.referrer,\n                custom_metric_name: \"userAgent\",\n                custom_metric_string_value: navigator.userAgent,\n            }\n        }).done(function() {\n            Log.debug('Liquidus sent page to kinesis.');\n        });\n    };\n\n    tracker.heartBeat = function() {\n        $.ajax({\n            url: tracker.trackerInfo.kinesisURL,\n            method: 'POST',\n            headers: {\n                userHash: tracker.trackerInfo.staticShares.userHash,\n                custom_metric_name: \"heartBeat\",\n                custom_metric_string_value: 1,\n            }\n        }).done(function() {\n            Log.debug('Liquidus sent heart beat to kinesis.');\n        });\n    };\n\n    tracker.processEvent = function(dfd, metricName, data) {\n        $.ajax({\n            url: tracker.trackerInfo.kinesisURL,\n            method: 'POST',\n            headers: {\n                userHash: tracker.trackerInfo.staticShares.userHash,\n                custom_metric_name: metricName,\n                custom_metric_string_value: JSON.stringify(data),\n            }\n        }).done(function() {\n            dfd.resolve(true);\n            Log.debug('AWS Kinesis promise resolved.');\n        });\n    };\n\n    return tracker;\n});\n"],"file":"kinesis-lazy.min.js"}