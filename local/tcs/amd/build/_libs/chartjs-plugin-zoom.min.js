function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}(function(a,b){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=b(require("chart.js"),require("hammerjs")):"function"==typeof define&&define.amd?define ("local_tcs/_libs/chartjs-plugin-zoom",["core/chartjs","local_tcs/_libs/hammer"],b):(a=a||self,a.ChartZoom=b(a.Chart,a.Hammer))})(this,function(a,b){'use strict';a=a&&a.hasOwnProperty("default")?a["default"]:a;b=b&&b.hasOwnProperty("default")?b["default"]:b;var p=a.helpers,q=a.Zoom=a.Zoom||{},r=q.zoomFunctions=q.zoomFunctions||{},s=q.panFunctions=q.panFunctions||{};a.Zoom.defaults=a.defaults.global.plugins.zoom={pan:{enabled:!1,mode:"xy",speed:20,threshold:10},zoom:{enabled:!1,mode:"xy",sensitivity:3,speed:.1}};function c(a,b){var c={};if("undefined"!=typeof a.options.pan){c.pan=a.options.pan}if("undefined"!=typeof a.options.pan){c.zoom=a.options.zoom}var d=a.$zoom;b=d._options=p.merge({},[b,c]);var e=d._node,f=b.zoom&&b.zoom.enabled,g=b.zoom.drag;if(f&&!g){e.addEventListener("wheel",d._wheelHandler)}else{e.removeEventListener("wheel",d._wheelHandler)}if(f&&g){e.addEventListener("mousedown",d._mouseDownHandler);e.ownerDocument.addEventListener("mouseup",d._mouseUpHandler)}else{e.removeEventListener("mousedown",d._mouseDownHandler);e.removeEventListener("mousemove",d._mouseMoveHandler);e.ownerDocument.removeEventListener("mouseup",d._mouseUpHandler)}}function d(a){var b=a.$zoom._originalOptions;p.each(a.scales,function(a){if(!b[a.id]){b[a.id]=p.clone(a.options)}});p.each(b,function(c,d){if(!a.scales[d]){delete b[d]}})}function e(a,b){if(a===void 0){return!0}else if("string"==typeof a){return-1!==a.indexOf(b)}return!1}function f(a,b){if(a.scaleAxes&&a.rangeMax&&!p.isNullOrUndef(a.rangeMax[a.scaleAxes])){var c=a.rangeMax[a.scaleAxes];if(b>c){b=c}}return b}function g(a,b){if(a.scaleAxes&&a.rangeMin&&!p.isNullOrUndef(a.rangeMin[a.scaleAxes])){var c=a.rangeMin[a.scaleAxes];if(b<c){b=c}}return b}function h(a,b,c,d){var e=a.max-a.min,h=e*(b-1),i=a.isHorizontal()?c.x:c.y,j=(a.getValueForPixel(i)-a.min)/e;a.options.ticks.min=g(d,a.min+h*j);a.options.ticks.max=f(d,a.max-h*(1-j))}function i(a,b,c,d){var e=r[a.type];if(e){e(a,b,c,d)}}function j(a,b,c,f,g,h){var j=a.chartArea;if(!f){f={x:(j.left+j.right)/2,y:(j.top+j.bottom)/2}}var k=a.$zoom._options.zoom;if(k.enabled){d(a);var l="function"==typeof k.mode?k.mode({chart:a}):k.mode,m;if("xy"===l&&g!==void 0){m=g}else{m="xy"}p.each(a.scales,function(a){if(a.isHorizontal()&&e(l,"x")&&e(m,"x")){k.scaleAxes="x";i(a,b,f,k)}else if(!a.isHorizontal()&&e(l,"y")&&e(m,"y")){k.scaleAxes="y";i(a,c,f,k)}});if(h){a.update({duration:h,easing:"easeOutQuad"})}else{a.update(0)}if("function"==typeof k.onZoom){k.onZoom({chart:a})}}}function k(a,b,c){var d=a.options.ticks,e=a.min,f=a.max,g=a.getValueForPixel(a.getPixelForValue(e)-b),h=a.getValueForPixel(a.getPixelForValue(f)-b);g=g.valueOf?g.valueOf():g;h=h.valueOf?h.valueOf():h;var i=g,j=h,k;if(c.scaleAxes&&c.rangeMin&&!p.isNullOrUndef(c.rangeMin[c.scaleAxes])){i=c.rangeMin[c.scaleAxes]}if(c.scaleAxes&&c.rangeMax&&!p.isNullOrUndef(c.rangeMax[c.scaleAxes])){j=c.rangeMax[c.scaleAxes]}if(g>=i&&h<=j){d.min=g;d.max=h}else if(g<i){k=e-i;d.min=i;d.max=f-k}else if(h>j){k=j-f;d.max=j;d.min=e+k}}function l(a,b,c){var d=s[a.type];if(d){d(a,b,c)}}function m(a,b,c){d(a);var f=a.$zoom._options.pan;if(f.enabled){var g="function"==typeof f.mode?f.mode({chart:a}):f.mode;p.each(a.scales,function(a){if(a.isHorizontal()&&e(g,"x")&&0!==b){f.scaleAxes="x";l(a,b,f)}else if(!a.isHorizontal()&&e(g,"y")&&0!==c){f.scaleAxes="y";l(a,c,f)}});a.update(0);if("function"==typeof f.onPan){f.onPan({chart:a})}}}function n(a){for(var b=a.scales,c=Object.keys(b),d=0,e;d<c.length;d++){e=b[c[d]];if(e.isHorizontal()){return e}}}function o(a){for(var b=a.scales,c=Object.keys(b),d=0,e;d<c.length;d++){e=b[c[d]];if(!e.isHorizontal()){return e}}}q.zoomFunctions.category=function(a,b,c,d){var e=a.chart.data.labels,h=a.minIndex,i=e.length-1,j=a.maxIndex,k=d.sensitivity,l=a.isHorizontal()?a.left+a.width/2:a.top+a.height/2,m=a.isHorizontal()?c.x:c.y;q.zoomCumulativeDelta=1<b?q.zoomCumulativeDelta+1:q.zoomCumulativeDelta-1;if(Math.abs(q.zoomCumulativeDelta)>k){if(0>q.zoomCumulativeDelta){if(m>=l){if(0>=h){j=Math.min(i,j+1)}else{h=Math.max(0,h-1)}}else if(m<l){if(j>=i){h=Math.max(0,h-1)}else{j=Math.min(i,j+1)}}q.zoomCumulativeDelta=0}else if(0<q.zoomCumulativeDelta){if(m>=l){h=h<j?h=Math.min(j,h+1):h}else if(m<l){j=j>h?j=Math.max(h,j-1):j}q.zoomCumulativeDelta=0}a.options.ticks.min=g(d,e[h]);a.options.ticks.max=f(d,e[j])}};q.zoomFunctions.time=function(a,b,c,d){h(a,b,c,d);var e=a.options;if(e.time){if(e.time.min){e.time.min=e.ticks.min}if(e.time.max){e.time.max=e.ticks.max}}};q.zoomFunctions.linear=h;q.zoomFunctions.logarithmic=h;q.panFunctions.category=function(a,b,c){var d=a.chart.data.labels,e=d.length-1,h=Math.max(a.ticks.length,1),i=c.speed,j=a.minIndex,k=Math.round(a.width/(h*i)),l;q.panCumulativeDelta+=b;j=q.panCumulativeDelta>k?Math.max(0,j-1):q.panCumulativeDelta<-k?Math.min(e-h+1,j+1):j;q.panCumulativeDelta=j!==a.minIndex?0:q.panCumulativeDelta;l=Math.min(e,j+h-1);a.options.ticks.min=g(c,d[j]);a.options.ticks.max=f(c,d[l])};q.panFunctions.time=function(a,b,c){k(a,b,c);var d=a.options;if(d.time){if(d.time.min){d.time.min=d.ticks.min}if(d.time.max){d.time.max=d.ticks.max}}};q.panFunctions.linear=k;q.panFunctions.logarithmic=k;q.panCumulativeDelta=0;q.zoomCumulativeDelta=0;var t={id:"zoom",afterInit:function afterInit(a){a.resetZoom=function(){d(a);var b=a.$zoom._originalOptions;p.each(a.scales,function(a){var c=a.options.time,d=a.options.ticks;if(b[a.id]){if(c){c.min=b[a.id].time.min;c.max=b[a.id].time.max}if(d){d.min=b[a.id].ticks.min;d.max=b[a.id].ticks.max}}else{if(c){delete c.min;delete c.max}if(d){delete d.min;delete d.max}}});a.update()}},beforeUpdate:function beforeUpdate(a,b){c(a,b)},beforeInit:function beforeInit(a,d){a.$zoom={_originalOptions:{}};var f=a.$zoom._node=a.ctx.canvas;c(a,d);var g=a.$zoom._options,h=g.pan&&g.pan.threshold;a.$zoom._mouseDownHandler=function(b){f.addEventListener("mousemove",a.$zoom._mouseMoveHandler);a.$zoom._dragZoomStart=b};a.$zoom._mouseMoveHandler=function(b){if(a.$zoom._dragZoomStart){a.$zoom._dragZoomEnd=b;a.update(0)}};a.$zoom._mouseUpHandler=function(b){if(!a.$zoom._dragZoomStart){return}f.removeEventListener("mousemove",a.$zoom._mouseMoveHandler);var c=a.$zoom._dragZoomStart,d=c.target.getBoundingClientRect().left,g=Math.min(c.clientX,b.clientX)-d,h=Math.max(c.clientX,b.clientX)-d,i=c.target.getBoundingClientRect().top,k=Math.min(c.clientY,b.clientY)-i,l=Math.max(c.clientY,b.clientY)-i,m=h-g,n=l-k;a.$zoom._dragZoomStart=null;a.$zoom._dragZoomEnd=null;if(0>=m&&0>=n){return}var o=a.chartArea,p=a.$zoom._options.zoom,q=o.right-o.left,r=e(p.mode,"x"),s=r&&m?1+(q-m)/q:1,t=o.bottom-o.top,u=e(p.mode,"y"),v=u&&n?1+(t-n)/t:1;j(a,s,v,{x:(g-o.left)/(1-m/q)+o.left,y:(k-o.top)/(1-n/t)+o.top},void 0,p.drag.animationDuration);if("function"==typeof p.onZoomComplete){p.onZoomComplete({chart:a})}};var i=null;a.$zoom._wheelHandler=function(b){var c=b.target.getBoundingClientRect(),d=b.clientX-c.left,e=b.clientY-c.top,f=a.$zoom._options.zoom,g=f.speed;if(0<=b.deltaY){g=-g}j(a,1+g,1+g,{x:d,y:e});clearTimeout(i);i=setTimeout(function(){if("function"==typeof f.onZoomComplete){f.onZoomComplete({chart:a})}},250);if(b.cancelable){b.preventDefault()}};if(b){var k=new b.Manager(f);k.add(new b.Pinch);k.add(new b.Pan({threshold:h}));var l,n=function(b){var c=1/l*b.scale,d=b.target.getBoundingClientRect(),e=b.center.x-d.left,f=b.center.y-d.top,g=Math.abs(b.pointers[0].clientX-b.pointers[1].clientX),h=Math.abs(b.pointers[0].clientY-b.pointers[1].clientY),i=g/h,k;if(.3<i&&1.7>i){k="xy"}else if(g>h){k="x"}else{k="y"}j(a,c,c,{x:e,y:f},k);var m=a.$zoom._options.zoom;if("function"==typeof m.onZoomComplete){m.onZoomComplete({chart:a})}l=b.scale};k.on("pinchstart",function(){l=1});k.on("pinch",n);k.on("pinchend",function(a){n(a);l=null;q.zoomCumulativeDelta=0});var o=null,p=null,r=!1,s=function(b){if(null!==o&&null!==p){r=!0;var c=b.deltaX-o,d=b.deltaY-p;o=b.deltaX;p=b.deltaY;m(a,c,d)}};k.on("panstart",function(a){o=0;p=0;s(a)});k.on("panmove",s);k.on("panend",function(){o=null;p=null;q.panCumulativeDelta=0;setTimeout(function(){r=!1},500);var b=a.$zoom._options.pan;if("function"==typeof b.onPanComplete){b.onPanComplete({chart:a})}});a.$zoom._ghostClickHandler=function(a){if(r&&a.cancelable){a.stopImmediatePropagation();a.preventDefault()}};f.addEventListener("click",a.$zoom._ghostClickHandler);a._mc=k}},beforeDatasetsDraw:function beforeDatasetsDraw(a){var b=a.ctx;if(a.$zoom._dragZoomEnd){var c=n(a),d=o(a),f=a.$zoom._dragZoomStart,g=a.$zoom._dragZoomEnd,h=c.left,i=c.right,j=d.top,k=d.bottom;if(e(a.$zoom._options.zoom.mode,"x")){var l=f.target.getBoundingClientRect().left;h=Math.min(f.clientX,g.clientX)-l;i=Math.max(f.clientX,g.clientX)-l}if(e(a.$zoom._options.zoom.mode,"y")){var m=f.target.getBoundingClientRect().top;j=Math.min(f.clientY,g.clientY)-m;k=Math.max(f.clientY,g.clientY)-m}var p=i-h,q=k-j,r=a.$zoom._options.zoom.drag;b.save();b.beginPath();b.fillStyle=r.backgroundColor||"rgba(225,225,225,0.3)";b.fillRect(h,j,p,q);if(0<r.borderWidth){b.lineWidth=r.borderWidth;b.strokeStyle=r.borderColor||"rgba(225,225,225)";b.strokeRect(h,j,p,q)}b.restore()}},destroy:function destroy(a){if(!a.$zoom){return}var b=a.$zoom,c=b._node;c.removeEventListener("mousedown",b._mouseDownHandler);c.removeEventListener("mousemove",b._mouseMoveHandler);c.ownerDocument.removeEventListener("mouseup",b._mouseUpHandler);c.removeEventListener("wheel",b._wheelHandler);c.removeEventListener("click",b._ghostClickHandler);delete a.$zoom;var d=a._mc;if(d){d.remove("pinchstart");d.remove("pinch");d.remove("pinchend");d.remove("panstart");d.remove("pan");d.remove("panend");d.destroy()}}};a.plugins.register(t);return t});
//# sourceMappingURL=chartjs-plugin-zoom.min.js.map
