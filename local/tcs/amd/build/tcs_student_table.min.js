define ("local_tcs/tcs_student_table",["jquery","local_tcs/jaxy","local_tcs/tcs_lib","core/modal_factory","core/modal_events","core/templates","local_tcs/_bootstrap_libs/bootstrap-table","local_tcs/_bootstrap_libs/bootstrap-editable","local_tcs/_bootstrap_libs/bootstrap-table-editable"],function(a,b,c){'use strict';return{getTableData:function getTableData(a){var c=new Promise(function(c){b.tcsAjax(JSON.stringify({call:"getUsersInExam",params:a,class:"StudentListAjax"})).then(function(a){var b=[];for(var d in a.users_in_centre){b.push(a.users_in_centre[d])}c(b)})});return c},updateTableData:function updateTableData(a){var c=new Promise(function(c){b.tcsAjax(JSON.stringify({call:"updateStudentList",params:a,class:"StudentListAjax"})).then(function(a){c(a)})});return c},addStudent:function addStudent(d){b.tcsAjax(JSON.stringify({call:"addStudentToList",params:d,class:"StudentListAjax"})).then(function(b){c.setHash({name:"tcs_dash_hash",value:b.dash_hash});a("#tcs_student_table_wacka").bootstrapTable("insertRow",{index:b.row_id,row:{id:b.row_id,user_id:d.uofl_id,exam_id:b.data.exam_id,username:b.data.username,course:b.data.course,examname:b.data.examname,room:b.data.room,signintime:c.unixToDate(b.data.timesigned),comments:b.data.comments,id_type:b.data.id_type,exam_type:b.data.exam_type,remove_user:{field:"operate",title:"Remove",align:"center",valign:"middle",clickToSelect:!1,formatter:function formatter(a,c){if(""==a||""==c){console.log("formatter fail")}var e="<button class=\"toast_remove_"+b.row_id+" btn btn-danger btn-lg\" id=\"tcs_remove_user_from_student_list\" data-id=\""+b.row_id+"\" data-user_id=\""+d.uofl_id+"\" data-username=\""+b.data.username+"\" data-exam_id=\""+b.data.exam_id+"\" data-room=\""+b.data.room+"\"><i class=\"fa fa-trash\"></i></button>";return e}}}});c.showMessage(b);c.updateStats([{class:"tcs_student_count",action:"add"},{class:"tcs_room_stat_"+b.data.room,action:"add"}])})},removeStudent:function removeStudent(a){var d=new Promise(function(d){b.tcsAjax(JSON.stringify({call:"removeStudentFromList",params:{id:a.id,user_id:a.user_id,username:a.username,exam_id:a.exam_id,room:a.room},class:"StudentListAjax"})).then(function(a){c.setHash({name:"tcs_dash_hash",value:a.dash_hash});d(a)})});return d},removeStudentConfirm:function removeStudentConfirm(a){var b=this;b.removeStudent({id:a.row_id,user_id:a.user_id,username:a.username,exam_id:a.exam_id,room:a.room}).then(function(a){b.removeStudentFromTable(a)})},removeStudentFromTable:function removeStudentFromTable(b){c.showMessage(b);c.updateStats([{class:"tcs_student_count",action:"sub"},{class:"tcs_room_stat_"+b.room,action:"sub"},{class:"tcs_written_today",action:"add"},{class:"tcs_written_semester",action:"add"}]);a("#tcs_student_table_wacka").bootstrapTable("removeByUniqueId",b.row_id)},removeConfirmModal:function removeConfirmModal(a){c.showMessage({msg_type:"show",theme:"light",icon:"fa fa-trash",title:"Confirm",titleColor:"#721C24",message:"Are you sure you want to remove "+a.username,messageColor:"#721C24",messageSize:"20",messageLineHeight:"80",color:"#f8d7da",iconColor:"#721C24",position:"topCenter",progressBarColor:"rgb(0, 255, 184)",closeOnEscape:!0,buttons:[["<button>Ok</button>",function(b,c){b.hide({transitionOut:"fadeOutDown"},c,"buttonName");this.removeStudentConfirm({row_id:a.row_id,user_id:a.user_id,username:a.username,exam_id:a.exam_id,room:a.room})},!0],["<button>Close</button>",function(a,b){a.hide({transitionOut:"fadeOutDown"},b,"buttonName")}]],onOpening:function onOpening(){},onClosing:function onClosing(){}})},student_table_test:function student_table_test(){console.log("$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$");console.log("student_table_test() -> SUCCESSFULLY CALLED");console.log("$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$")},initiateStudentTable:function initiateStudentTable(){var b=this;this.getTableData({startup:!0}).then(function(b){if(0==b.length){a("#tcs_student_table_wacka").bootstrapTable()}else{a("#tcs_student_table_wacka").bootstrapTable({data:b,columns:[{title:"id",field:"id"},{title:"Username",field:"username"},{title:"Course",field:"course"},{title:"Exam Name",field:"examname"},{title:"Room #",field:"room"},{title:"Time Signed In",field:"signintime",formatter:function formatter(a){if(!isNaN(a)){return c.unixToDate(a)}return a}},{title:"Comments",field:"comments"},{field:"operate",title:"Remove",align:"center",valign:"middle",clickToSelect:!1,formatter:function formatter(a,b){if(""==a||""==b){console.log("formatter fail")}var c="<button class=\"toast_remove_"+b.id+" btn btn-danger btn-lg\" id=\"tcs_remove_user_from_student_list\" data-id=\""+b.id+"\" data-user_id=\""+b.user_id+"\" data-username=\""+b.username+"\" data-exam_id=\""+b.exam_id+"\" data-room=\""+b.room+"\"><i class=\"fa fa-trash\"></i></button>";return c}},{title:"User ID",field:"user_id"},{title:"Exam ID",field:"exam_id"},{title:"ID Type",field:"id_type"},{title:"Exam Type",field:"exam_type"}]})}a(".tcs_autocomp_in").focus()});a("#tcs_student_table_wacka").on("editable-save.bs.table",function(a,d,e){var f={id:e.id,username:e.username};if("room"==d){if(isNaN(e.room)){alert("Not Save, please enter a number");return}f.room=e.room}else if("comments"==d){f.comment=e.comments}else{console.log("Ooooops, this column: "+d+" was edited but is not room or comment.......?")}b.updateTableData(f).then(function(a){c.showMessage(a)})});a("body").on("click","#tcs_remove_user_from_student_list",function(){var d=a(this).data("id"),e=a(this).data("user_id"),f=a(this).data("username"),g=a(this).data("exam_id"),h=a(this).data("room");c.showMessage({msg_type:"show",theme:"light",icon:"fa fa-trash",title:"Confirm",titleColor:"#721C24",message:"Are you sure you want to remove "+f,messageColor:"#721C24",messageSize:"20",messageLineHeight:"80",color:"#f8d7da",iconColor:"#721C24",position:"topCenter",progressBarColor:"rgb(0, 255, 184)",closeOnEscape:!0,buttons:[["<button>Ok</button>",function(a,c){a.hide({transitionOut:"fadeOutDown"},c,"buttonName");b.removeStudentConfirm({row_id:d,user_id:e,username:f,exam_id:g,room:h})},!0],["<button>Close</button>",function(a,b){a.hide({transitionOut:"fadeOutDown"},b,"buttonName")}]],onOpening:function onOpening(){console.info("callback abriu!")},onClosing:function onClosing(){}})})}}});
//# sourceMappingURL=tcs_student_table.min.js.map
