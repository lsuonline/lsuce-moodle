function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}(function(a,b){if("function"==typeof define&&define.amd){define ("local_tcs/skezzy_timeline",["jquery","jqueryui","local_tcs/_libs/moment"],b);return}var c=b();if("object"===("undefined"==typeof module?"undefined":_typeof(module))){module.exports=c;return}a[c.name]=c})(this,function(a,b,c){'use strict';var d={Options:{GetSections:function GetSections(){},GetSchedule:function GetSchedule(){},Start:c(),HeaderFormat:"Do MMM YYYY",LowerFormat:"DD-MMM-YYYY HH:mm",Periods:[{Name:"2 days",Label:"2 days",TimeframePeriod:120,TimeframeOverall:2880,TimeframeHeaders:["Do MMM","HH"],Classes:"time-sch-period-2day"},{Name:"2 weeks",Label:"2 weeks",TimeframePeriod:1440,TimeframeOverall:20160,TimeframeHeaders:["MMM","Do"],Classes:"time-sch-period-2week"}],SelectedPeriod:"2 weeks",Element:a("<div></div>"),MinRowHeight:40,ShowCurrentTime:!0,ShowGoto:!0,ShowToday:!0,Text:{NextButton:"Next",NextButtonTitle:"Next period",PrevButton:"Prev",PrevButtonTitle:"Previous period",TodayButton:"Today",TodayButtonTitle:"Go to today",GotoButton:"Go to",GotoButtonTitle:"Go to specific date"},Events:{ItemMouseEnter:null,ItemMouseLeave:null,ItemClicked:null,ItemDropped:null,ItemResized:null,ItemMovement:null,ItemMovementStart:null,ItemMovementEnd:null,ItemEventClick:null,ItemEventMouseEnter:null,ItemEventMouseLeave:null},AllowDragging:!1,AllowResizing:!1,DisableOnMove:!0,MaxHeight:null},Wrapper:null,HeaderWrap:null,TableWrap:null,ContentHeaderWrap:null,ContentWrap:null,TableHeader:null,TableContent:null,SectionWrap:null,Table:null,Sections:{},CachedSectionResult:null,CachedScheduleResult:null,SetupPrototypes:function SetupPrototypes(){c.fn.tsAdd=function(a,b){var d;if("string"==typeof a){d=c.duration(+b,a)}else{d=c.duration(a,b)}this.tsAddOrSubtractDurationFromMoment(this,d,1);return this};c.fn.tsSubtract=function(a,b){var d;if("string"==typeof a){d=c.duration(+b,a)}else{d=c.duration(a,b)}this.tsAddOrSubtractDurationFromMoment(this,d,-1);return this};c.fn.tsAddOrSubtractDurationFromMoment=function(a,b,c){var e=b._milliseconds,f=b._days,d=b._months,g;if(e){a.milliseconds(a.milliseconds()+e*c)}if(f){a.date(a.date()+f*c)}if(d){g=a.date();a.date(1).month(a.month()+d*c).date(Math.min(g,a.daysInMonth()))}}},Init:function Init(b){console.log("skezzy_timeline.js -> Init() -> START");d.SetupPrototypes();d.Options.Start=c(d.Options.Start);d.Options.Element.find(".ui-draggable").draggable("destroy");d.Options.Element.empty();d.Wrapper=a(document.createElement("div")).addClass("time-sch-wrapper").appendTo(d.Options.Element);d.HeaderWrap=a(document.createElement("div")).addClass("time-sch-header-wrapper time-sch-clearfix").appendTo(d.Wrapper);d.TableWrap=a(document.createElement("div")).addClass("time-sch-table-wrapper").appendTo(d.Wrapper);d.CreateCalendar();d.FillSections(b)},GetSelectedPeriod:function GetSelectedPeriod(){console.log("skezzy_timeline.js -> GetSelectedPeriod() -> START");for(var a,b=0;b<d.Options.Periods.length;b++){if(d.Options.Periods[b].Name===d.Options.SelectedPeriod){a=d.Options.Periods[b];break}}if(!a){a=d.Options.Periods[0];d.SelectPeriod(a.Name)}return a},GetEndOfPeriod:function GetEndOfPeriod(a,b){console.log("skezzy_timeline.js -> GetEndOfPeriod() -> START");return c(a).tsAdd("minutes",b.TimeframeOverall)},AddHeaderClasses:function AddHeaderClasses(b,c,e){console.log("skezzy_timeline.js -> AddHeaderClasses() -> START");var f,g,h,i,j,k,l,m,n,o;f=d.TableHeader.find("tr");if(e!==void 0){f=a(f.get(e))}if(f.length&&0<f.length){g=a.makeArray(f);for(var p=0;p<g.length;p++){n=!1;l=0;h=a(g[p]);i=a.makeArray(h.find(".time-sch-date-header"));for(var q=0;q<i.length&&!n;q++){j=a(i[q]);m=+j.attr("colspan");if(m&&!isNaN(m)&&0<m){k=l?l:0;l=k+m}else{k=l?l:0;l=k+1}if(k===c){b.addClass("time-sch-header-"+p+"-date-start")}if(l-1===c){b.addClass("time-sch-header-"+p+"-date-end")}if(k<=c&&c<l){n=!0;o=0==q%2;b.addClass("time-sch-header-"+p+"-date-column-"+q).addClass("time-sch-header-"+p+"-date-"+(o?"even":"odd"));if(j.hasClass("time-sch-header-"+p+"-current-time")){b.addClass("time-sch-header-"+p+"-current-time")}}}}}},CreateCalendar:function CreateCalendar(){console.log("skezzy_timeline.js -> CreateCalendar() -> START");var b,e,f,g,h,j,k,l,m,n,o,p,q,r;p=0;j=d.GetSelectedPeriod();k=d.GetEndOfPeriod(d.Options.Start,j);g=Math.abs(d.Options.Start.diff(k,"minutes"));h=g/j.TimeframePeriod;d.ContentHeaderWrap=a(document.createElement("div")).addClass("time-sch-content-header-wrap").appendTo(d.TableWrap);d.ContentWrap=a(document.createElement("div")).addClass("time-sch-content-wrap").appendTo(d.TableWrap);d.TableHeader=a(document.createElement("table")).addClass("time-sch-table time-sch-table-header").appendTo(d.ContentHeaderWrap);d.TableContent=a(document.createElement("table")).addClass("time-sch-table time-sch-table-content").appendTo(d.ContentWrap);d.SectionWrap=a(document.createElement("div")).addClass("time-sch-section-wrapper").appendTo(d.ContentWrap);if(j.Classes){d.TableWrap.toggleClass(j.Classes,!0)}for(var s=0;s<j.TimeframeHeaders.length;s++){m=null;o=null;r=!0;p=0;q=0;f=j.TimeframeHeaders[s];b=a(document.createElement("tr")).addClass("time-sch-times time-sch-times-header-"+s).appendTo(d.TableHeader);e=a(document.createElement("td")).addClass("time-sch-section time-sch-section-header").appendTo(b);for(var t=0;t<h;t++){l=c(d.Options.Start).tsAdd("minutes",t*j.TimeframePeriod);n=l.format(f);if(o!==n){if(m){e.attr("colspan",p);p=0;if(c()>=m&&c()<l){e.addClass("time-sch-header-"+s+"-current-time")}}m=l;o=n;e=a(document.createElement("td")).data("header-row",s).data("column-count",t).data("column-is-even",r).addClass("time-sch-date time-sch-date-header").append(n).appendTo(b);e.addClass("time-sch-header-"+s+"-date-start").addClass("time-sch-header-"+s+"-date-end").addClass("time-sch-header-"+s+"-date-column-"+q).addClass("time-sch-header-"+s+"-date-"+(0==q%2?"even":"odd"));for(var u=0;u<s;u++){d.AddHeaderClasses(e,t,u)}q+=1}p+=1}e.attr("colspan",p)}d.FillHeader()},CreateSections:function CreateSections(b){console.log("skezzy_timeline.js -> CreateSections() -> START");var c,e,f,g,h,j;c=1;h=a.makeArray(d.TableHeader.find("tr"));for(j=0;j<h.length;j++){if(c<a(h[j]).find(".time-sch-date-header").length){c=a(h[j]).find(".time-sch-date-header").length}}for(j=0;j<b.length;j++){e=a(document.createElement("tr")).addClass("time-sch-section-row").addClass(0==j%2?"time-sch-section-even":"time-sch-section-odd").css("height",d.Options.MinRowHeight).appendTo(d.TableContent);g=a(document.createElement("div")).addClass("time-sch-section-container").css("height",d.Options.MinRowHeight).data("section",b[j]).appendTo(d.SectionWrap);f=a(document.createElement("td")).addClass("time-sch-section time-sch-section-content").data("section",b[j]).append(b[j].name).appendTo(e);for(var k=0;k<c;k++){f=a(document.createElement("td")).addClass("time-sch-date time-sch-date-content").appendTo(e);d.AddHeaderClasses(f,k)}d.Sections[b[j].id]={row:e,container:g}}d.SectionWrap.css({left:d.Options.Element.find(".time-sch-section").outerWidth()});if(d.Options.ShowCurrentTime){d.ShowCurrentTime()}},ShowCurrentTimeHandle:null,ShowCurrentTime:function ShowCurrentTime(){console.log("skezzy_timeline.js -> ShowCurrentTime() -> START");var b,e,f,g,h;if(d.ShowCurrentTimeHandle){clearTimeout(d.ShowCurrentTimeHandle)}b=c();h=d.GetEndOfPeriod(d.Options.Start,d.GetSelectedPeriod());f=Math.abs(d.Options.Start.diff(h,"minutes"));g=Math.abs(d.Options.Start.diff(b,"minutes"));e=d.Options.Element.find(".time-sch-current-time");e.remove();if(b>=d.Options.Start&&b<=h){e=a(document.createElement("div")).addClass("time-sch-current-time").css("left",100*(g/f)+"%").attr("title",b.format(d.Options.LowerFormat)).appendTo(d.SectionWrap)}d.ShowCurrentTimeHandle=setTimeout(d.ShowCurrentTime,3e4)},CreateItems:function CreateItems(b){console.log("skezzy_timeline.js -> CreateItems() -> START");console.log("skezzy_timeline.js -> CreateItems -> START");var e,f,g,h,j,k,l,m,n,o,p,q,r,s,t={},u,v,w,x,y,z,A;y=d.GetSelectedPeriod();z=d.GetEndOfPeriod(d.Options.Start,y);k=Math.abs(d.Options.Start.diff(z,"minutes"));for(A=0;A<b.length;A++){e=b[A];g=d.Sections[e.sectionID];if(g){if(!t[e.sectionID]){t[e.sectionID]=[]}if(e.start<=z&&e.end>=d.Options.Start){u=null;r=c(Math.max(e.start,d.Options.Start));s=c(Math.min(e.end,z));l=r.diff(d.Options.Start,"minutes");m=Math.abs(r.diff(s,"minutes"));o=0;p=100*(l/k);q=100*(m/k);h=a(document.createElement("div")).addClass("time-sch-item "+(e.classes?e.classes:"")).css({top:o,left:p+"%",width:q+"%"}).appendTo(g.container);j=a(document.createElement("div")).addClass("time-sch-item-content").appendTo(h);if(e.name){a(document.createElement("div")).append(e.name).appendTo(j)}if(e.events){for(var B=0;B<e.events.length;B++){f=e.events[B];n=100*(f.at.diff(r,"minutes")/m);a(document.createElement("div")).addClass("time-sch-item-event "+(f.classes?f.classes:"")).css("left",n+"%").attr("title",f.at.format(d.Options.LowerFormat)+" - "+f.label).data("event",f).appendTo(h)}}if(e.start>=d.Options.Start){a(document.createElement("div")).addClass("time-sch-item-start").appendTo(h)}if(e.end<=z){a(document.createElement("div")).addClass("time-sch-item-end").appendTo(h)}e.Element=h;for(var C=0;C<t[e.sectionID].length;C++){if(t[e.sectionID][C].start>e.start){u=C;break}}if(null===u){u=t[e.sectionID].length}t[e.sectionID].splice(u,0,e);h.data("item",e);d.SetupItemEvents(h)}}}for(var D in t){g=d.Sections[D];for(A=0;A<t[D].length;A++){var E,F;v=t[D][A];for(var G=0;G<A;G++){var H,I;w=t[D][G];H=w.Element.position().top;I=H+w.Element.outerHeight();E=v.Element.position().top;F=E+v.Element.outerHeight();x=(w.start<=v.start&&v.start<=w.end||w.start<=v.end&&v.end<=w.end)&&(H<=E&&E<=I||H<=F&&F<=I);if(x){v.Element.css("top",I+1)}}F=v.Element.position().top+v.Element.outerHeight()+1;if(F>g.container.height()){g.container.css("height",F);g.row.css("height",F)}}}},SetupItemEvents:function SetupItemEvents(b){console.log("skezzy_timeline.js -> SetupItemEvents() -> START");if(d.Options.Events.ItemClicked){b.click(function(b){b.preventDefault();d.Options.Events.ItemClicked.call(this,a(this).data("item"))})}if(d.Options.Events.ItemMouseEnter){b.mouseenter(function(){d.Options.Events.ItemMouseEnter.call(this,a(this).data("item"))})}if(d.Options.Events.ItemMouseLeave){b.mouseleave(function(){d.Options.Events.ItemMouseLeave.call(this,a(this).data("item"))})}if(d.Options.AllowDragging){b.draggable({helper:"clone",zIndex:1,appendTo:d.SectionWrap,distance:5,snap:".time-sch-section-container",snapMode:"inner",snapTolerance:10,drag:function drag(b,e){console.log("skezzy_timeline.js -> SetupItemEvents() -> (draggable event) - drag() -> START");var f,g,h,i,j,k;if(d.Options.Events.ItemMovement){i=d.GetSelectedPeriod();j=d.GetEndOfPeriod(d.Options.Start,i);k=Math.abs(d.Options.Start.diff(j,"minutes"));f=a(b.target).data("item");g=c(d.Options.Start).tsAdd("minutes",k*(e.helper.position().left/d.SectionWrap.width()));h=c(g).tsAdd("minutes",Math.abs(f.start.diff(f.end,"minutes")));if(f.start<d.Options.Start){g.tsAdd("minutes",f.start.diff(d.Options.Start,"minutes"));h.tsAdd("minutes",f.start.diff(d.Options.Start,"minutes"))}d.Options.Events.ItemMovement.call(this,f,g,h)}},start:function start(b,c){console.log("skezzy_timeline.js -> SetupItemEvents() -> (draggable event) - start() -> START");a(this).hide();c.helper.children().not(".time-sch-item-content").remove();if(d.Options.Events.ItemMovementStart){d.Options.Events.ItemMovementStart.call(this)}},stop:function stop(){console.log("skezzy_timeline.js -> SetupItemEvents() -> (draggable event) - stop() -> START");if(a(this).length){a(this).show()}if(d.Options.Events.ItemMovementEnd){d.Options.Events.ItemMovementEnd.call(this)}},cancel:".time-sch-item-end, .time-sch-item-start, .time-sch-item-event"});a(".time-sch-section-container").droppable({greedy:!0,hoverClass:"time-sch-droppable-hover",tolerance:"pointer",drop:function drop(b,e){console.log("skezzy_timeline.js -> SetupItemEvents() -> (droppable event) - drop() -> START");var f,g,h,i,j,k,l;j=d.GetSelectedPeriod();k=d.GetEndOfPeriod(d.Options.Start,j);l=Math.abs(d.Options.Start.diff(k,"minutes"));f=e.draggable.data("item");g=a(this).data("section").id;h=c(d.Options.Start).tsAdd("minutes",l*(e.helper.position().left/a(this).width()));i=c(h).tsAdd("minutes",Math.abs(f.start.diff(f.end,"minutes")));if(f.start<d.Options.Start){h.tsAdd("minutes",f.start.diff(d.Options.Start,"minutes"));i.tsAdd("minutes",f.start.diff(d.Options.Start,"minutes"))}e.draggable.appendTo(a(this));e.draggable.css({left:e.helper.position().left-a(this).position().left,top:e.helper.position().top-a(this).position().top});if(d.Options.DisableOnMove){if(e.draggable.data("uiDraggable")){e.draggable.draggable("disable")}if(e.draggable.data("uiResizable")){e.draggable.resizable("disable")}}e.draggable.show();if(d.Options.Events.ItemDropped){setTimeout(function(){d.Options.Events.ItemDropped.call(this,f,g,h,i)},0)}}})}if(d.Options.AllowResizing){var e=null;if(b.find(".time-sch-item-start").length&&b.find(".time-sch-item-end").length){e="e, w"}else if(b.find(".time-sch-item-start").length){e="w"}else if(b.find(".time-sch-item-end").length){e="e"}if(e){b.resizable({handles:e,resize:function resize(b,e){console.log("skezzy_timeline.js -> SetupItemEvents() -> (resizable event) - resize() -> START");var f,g,h,i,j,k;if(d.Options.Events.ItemMovement){i=d.GetSelectedPeriod();j=d.GetEndOfPeriod(d.Options.Start,i);k=Math.abs(d.Options.Start.diff(j,"minutes"));f=a(this).data("item");if(e.position.left!==e.originalPosition.left){g=c(d.Options.Start).tsAdd("minutes",k*(a(this).position().left/d.SectionWrap.width()));h=f.end}else{g=f.start;h=c(d.Options.Start).tsAdd("minutes",k*((a(this).position().left+a(this).width())/d.SectionWrap.width()))}d.Options.Events.ItemMovement.call(this,f,g,h)}},start:function start(){console.log("skezzy_timeline.js -> SetupItemEvents() -> (resizable event) - start() -> START");a(this).find(".time-sch-item-event").hide();if(d.Options.Events.ItemMovementStart){d.Options.Events.ItemMovementStart.call(this)}},stop:function stop(b,e){console.log("skezzy_timeline.js -> SetupItemEvents() -> (resizable event) - stop() -> START");var f,g,h,i,j,k,l;l=a(this);i=d.GetSelectedPeriod();j=d.GetEndOfPeriod(d.Options.Start,i);k=Math.abs(d.Options.Start.diff(j,"minutes"));f=l.data("item");if(e.position.left!==e.originalPosition.left){g=c(d.Options.Start).tsAdd("minutes",k*(l.position().left/d.SectionWrap.width()));h=f.end}else{g=f.start;h=c(d.Options.Start).tsAdd("minutes",k*((l.position().left+l.width())/d.SectionWrap.width()))}if(d.Options.DisableOnMove){if(l.data("uiDraggable")){l.draggable("disable")}if(l.data("uiResizable")){l.resizable("disable")}l.find(".time-sch-item-event").show()}if(d.Options.Events.ItemMovementEnd){d.Options.Events.ItemMovementEnd.call(this)}if(d.Options.Events.ItemResized){d.Options.Events.ItemResized.call(this,f,g,h)}}})}}if(d.Options.Events.ItemEventClicked){b.find(".time-sch-item-event").click(function(b){var c=a(this).closest(".time-sch-item");b.preventDefault();d.Options.Events.ItemEventClicked.call(this,a(this).data("event"),c.data("item"))})}if(d.Options.Events.ItemEventMouseEnter){b.find(".time-sch-item-event").mouseenter(function(b){var c=a(this).closest(".time-sch-item");b.preventDefault();d.Options.Events.ItemEventClicked.call(this,a(this).data("event"),c.data("item"))})}if(d.Options.Events.ItemEventMouseLeave){b.find(".time-sch-item-event").mouseleave(function(b){var c=a(this).closest(".time-sch-item");b.preventDefault();d.Options.Events.ItemEventClicked.call(this,a(this).data("event"),c.data("item"))})}},FillSections:function FillSections(a){console.log("skezzy_timeline.js -> FillSections() -> START");if(!d.CachedSectionResult||a){d.Options.GetSections.call(this,d.FillSections_Callback)}else{d.FillSections_Callback(d.CachedSectionResult)}},FillSections_Callback:function FillSections_Callback(a){console.log("skezzy_timeline.js -> FillSections_Callback() -> START");d.CachedSectionResult=a;d.CreateSections(a);d.FillSchedule()},FillSchedule:function FillSchedule(){console.log("skezzy_timeline.js -> FillSchedule() -> START");var a,b;a=d.GetSelectedPeriod();b=d.GetEndOfPeriod(d.Options.Start,a);d.Options.GetSchedule.call(this,d.FillSchedule_Callback,d.Options.Start,b)},FillSchedule_Callback:function FillSchedule_Callback(a){console.log("skezzy_timeline.js -> FillSchedule_Callback() -> START");d.CachedScheduleResult=a;d.CreateItems(a)},FillHeader:function FillHeader(){console.log("skezzy_timeline.js -> FillHeader() -> START");var b,c,e,f,g,h;c=a(document.createElement("div")).addClass("time-sch-period-container");e=a(document.createElement("div")).addClass("time-sch-time-container");b=a(document.createElement("div")).addClass("time-sch-title");d.HeaderWrap.empty().append(c,e,b);f=d.GetSelectedPeriod();g=d.GetEndOfPeriod(d.Options.Start,f);b.text(d.Options.Start.format(d.Options.HeaderFormat)+" - "+g.tsAdd("minutes",-1).format(d.Options.HeaderFormat));for(var j=0;j<d.Options.Periods.length;j++){h=d.Options.Periods[j];a(document.createElement("a")).addClass("time-sch-period-button time-sch-button").addClass(h.Name===f.Name?"time-sch-selected-button":"").attr("href","#").append(h.Label).data("period",h).click(d.Period_Clicked).appendTo(c)}if(d.Options.ShowGoto){a(document.createElement("a")).addClass("time-sch-time-button time-sch-time-button-goto time-sch-button").attr({href:"#",title:d.Options.Text.GotoButtonTitle}).append(d.Options.Text.GotoButton).click(d.GotoTimeShift_Clicked).appendTo(e)}if(d.Options.ShowToday){a(document.createElement("a")).addClass("time-sch-time-button time-sch-time-button-today time-sch-button").attr({href:"#",title:d.Options.Text.TodayButtonTitle}).append(d.Options.Text.TodayButton).click(d.TimeShift_Clicked).appendTo(e)}a(document.createElement("a")).addClass("time-sch-time-button time-sch-time-button-prev time-sch-button").attr({href:"#",title:d.Options.Text.PrevButtonTitle}).append(d.Options.Text.PrevButton).click(d.TimeShift_Clicked).appendTo(e);a(document.createElement("a")).addClass("time-sch-time-button time-sch-time-button-next time-sch-button").attr({href:"#",title:d.Options.Text.NextButtonTitle}).append(d.Options.Text.NextButton).click(d.TimeShift_Clicked).appendTo(e)},GotoTimeShift_Clicked:function GotoTimeShift_Clicked(b){console.log("skezzy_timeline.js -> GotoTimeShift_Clicked() -> START");b.preventDefault();a(document.createElement("input")).attr("type","text").css({position:"absolute",left:0,bottom:0}).appendTo(a(this)).datepicker({onClose:function onClose(){console.log("skezzy_timeline.js -> GotoTimeShift_Clicked() -> onClose() -> START");a(this).remove()},onSelect:function onSelect(a){console.log("skezzy_timeline.js -> GotoTimeShift_Clicked() -> onSelect() -> START");d.Options.Start=c(a);d.Init()},defaultDate:d.Options.Start.toDate()}).datepicker("show").hide()},TimeShift_Clicked:function TimeShift_Clicked(b){console.log("skezzy_timeline.js -> TimeShift_Clicked() -> START");var e;b.preventDefault();e=d.GetSelectedPeriod();if(a(this).is(".time-sch-time-button-today")){d.Options.Start=c().startOf("day")}else if(a(this).is(".time-sch-time-button-prev")){d.Options.Start.tsAdd("minutes",-1*e.TimeframeOverall)}else if(a(this).is(".time-sch-time-button-next")){d.Options.Start.tsAdd("minutes",e.TimeframeOverall)}d.Init()},SelectPeriod:function SelectPeriod(a){console.log("skezzy_timeline.js -> SelectPeriod() -> START");d.Options.SelectedPeriod=a;d.Init()},Period_Clicked:function Period_Clicked(b){console.log("skezzy_timeline.js -> Period_Clicked() -> START");b.preventDefault();d.SelectPeriod(a(this).data("period").Name)}};return d});
//# sourceMappingURL=skezzy_timeline.min.js.map
