define ("local_tcs/tcs_exam_table",["jquery","local_tcs/tcs_lib","core/modal_factory","core/modal_events","core/templates","local_tcs/_libs/moment","local_tcs/_libs/jquery.autocomplete","local_tcs/_bootstrap_libs/bootstrap-table","local_tcs/_bootstrap_libs/bootstrap-editable","local_tcs/_bootstrap_libs/bootstrap-table-editable","local_tcs/_bootstrap_libs/bootstrap-table-toolbar"],function(a,b,c,d,e){'use strict';return{getExamData:function getExamData(){return b.jaxyPromise({call:"getAllOpenExams",params:{},class:"Exams"})},updateTableData:function updateTableData(a){return b.jaxyPromise({call:a.call,params:a.data,class:"Exams"})},addManualExam:function addManualExam(a){return b.jaxyPromise({call:"addManualExams",params:a,class:"Exams"})},editManualExam:function editManualExam(a){return b.jaxyPromise({call:"updateExam",params:a,class:"Exams"})},checkForm:function checkForm(){return a("#tc_manual_exam_course_name").val()&&a("#tc_manual_exam_exam_name").val()&&a("#tc_manual_exam_opening_date").val()&&a("#tc_manual_exam_closing_date").val()&&a("#tc_manual_exam_password").val()&&a("#tc_manual_exam_student_list").val()},findeUpdatedData:function findeUpdatedData(){var b={};if(this.stored_edit_obj.course_name!=a("#tc_manual_exam_course_name").val()){b.course_name=a("#tc_manual_exam_course_name").val()}if(this.stored_edit_obj.exam_name!=a("#tc_manual_exam_exam_name").val()){b.exam_name=a("#tc_manual_exam_exam_name").val()}if(this.stored_edit_obj.opening_date!=a("#tc_manual_exam_opening_date").val()){b.opening_date=a("#tc_manual_exam_opening_date").val()}if(this.stored_edit_obj.closing_date!=a("#tc_manual_exam_closing_date").val()){b.closing_date=a("#tc_manual_exam_closing_date").val()}if(this.stored_edit_obj.password!=a("#tc_manual_exam_password").val()){b.password=a("#tc_manual_exam_password").val()}if(this.stored_edit_obj.password!=a("#tc_manual_exam_student_list").val()){b.student_list=a("#tc_manual_exam_student_list").val()}if(this.stored_edit_obj.notes!=a("#tc_manual_exam_notes").val()||""!=a("#tc_manual_exam_notes").val()){b.notes=a("#tc_manual_exam_notes").val()}b.row_id=this.stored_edit_obj.id;b.exam_id=this.stored_edit_obj.exam_id;b.manual="true";return b},updateTableRow:function updateTableRow(a){a.row_id=a.id;var c="updateExam",d="";if("false"==a.manual){c="addUpdateMoodleExam";d=a}else{d={row_id:a.row_id,exam_id:a.exam_id,notes:a.notes,visible:a.visible,manual:a.manual,finished:a.finished}}var e={call:c,data:d};this.updateTableData(e).then(function(a){b.showMessage(a)})},modalAddEditManualExam:function modalAddEditManualExam(f,g){var h="Manual Exam",i="Save",j=this;if("add"==g){h="Add Manual Exam";i="Add Exam"}else{h="Edit Manual Exam";i="Update Exam"}c.create({type:c.types.SAVE_CANCEL,title:h,body:e.render("local_tcs/modal_entermanualexam",f),large:!0}).then(function(c){c.setSaveButtonText(i);var e=c.getRoot();e.on(d.save,function(){if(j.checkForm()){if("add"==g){j.addManualExam({course_name:a("#tc_manual_exam_course_name").val(),exam_name:a("#tc_manual_exam_exam_name").val(),opening_date:a("#tc_manual_exam_opening_date").val(),closing_date:a("#tc_manual_exam_closing_date").val(),password:a("#tc_manual_exam_password").val(),student_list:a("#tc_manual_exam_student_list").val(),notes:a("#tc_manual_exam_notes").val()}).then(function(c){var d=a("#tcs_exam_table").bootstrapTable("getOptions").totalRows;a("#tcs_exam_table").bootstrapTable("insertRow",{index:0,row:{id:d+1,exam_id:c.data.exam_id,course_id:c.data.course_id,manual:c.data.manual,course_name:c.data.course_name,exam_name:c.data.exam_name,opening_date:c.data.opening_date,closing_date:c.data.closing_date,password:c.data.password,student_list:c.data.student_list,notes:c.data.notes,visible:c.data.visible}});b.showMessage(c)})}else{var c=j.findeUpdatedData();j.editManualExam(c).then(function(c){a("#tcs_exam_table").bootstrapTable("updateRow",{index:c.data.id,row:c.data});b.showMessage(c)})}}else{b.showMessage({msg_type:"error",show_msg:{title:"Ooops",message:"Sorry, you have missed something in the form",position:"center"}});return!1}});c.getRoot().on(d.hidden,function(){c.destroy()});c.show()})},initiateExamTable:function initiateExamTable(){var c=this;this.getExamData().then(function(c){var d=[];if(!0===c.success){for(var e in c.data){d.push(c.data[e])}}a("#tcs_exam_table").bootstrapTable({undefinedText:"",data:d,pageSize:50,columns:[{title:"ID",field:"id"},{title:"Exam ID",field:"exam_id"},{title:"Course ID",field:"course_id"},{title:"Manual",field:"manual"},{title:"Course",field:"course_name"},{title:"Exam",field:"exam_name"},{title:"Opening Date",field:"opening_date",formatter:function formatter(a){if(!isNaN(a)){return b.unixToDate(a)}return a}},{title:"Closing Date",field:"closing_date",formatter:function formatter(a){if(!isNaN(a)){return b.unixToDate(a)}return a}},{title:"Passowrd",field:"password"},{title:"Notes",field:"notes"},{title:"Student List",field:"student_list"},{title:"Visibility",field:"operate",align:"center",valign:"middle",clickToSelect:!1,formatter:function formatter(a,b){var c="";if("true"==b.visible){c="<select class=\"form-control select tcs_manual_exam_status_changed\" style=\"min-width:75px;\" data-exam_id=\""+b.id+"\"><option value=\"1\">Hidden</option><option value=\"2\" selected>Visible</option></select>"}else{c="<select class=\"form-control select tcs_manual_exam_status_changed\" style=\"min-width:75px;\" data-exam_id=\""+b.id+"\"><option value=\"1\" selected>Hidden</option><option value=\"2\">Visible</option></select>"}return c}},{title:"Subnet",field:"subnet"},{title:"Finished",field:"operate",align:"center",valign:"middle",clickToSelect:!1,formatter:function formatter(a,b){if("true"==b.finished){return"EXAM IS DONE"}return"Exam is Active"}},{title:"Edit/Remove",field:"operate",align:"center",valign:"middle",clickToSelect:!1,formatter:function formatter(a,b){var c="";if("true"==b.finished){c="<div class=\"btn-group\"><button class=\"toast_bring_back_"+b.id+" btn btn-warning btn-lg\" id=\"tcs_bring_back_manual_exam\" data-id=\""+b.id+"\"><i class=\"fa fa-mail-reply\"></i></button></div>";return c}if("false"!=b.manual){c="<div class=\"btn-group\"><button class=\"toast_edit_"+b.id+" btn btn-success btn-lg\" id=\"tcs_edit_manual_exam\" data-id=\""+b.id+"\"><i class=\"fa fa-pencil\"></i></button><button class=\"toast_remove_"+b.id+" btn btn-danger btn-lg\" id=\"tcs_remove_exam\" data-id=\""+b.id+"\"><i class=\"fa fa-trash\"></i></button></div>"}return c}}]})});a("#tcs_exam_table").on("change",".tcs_manual_exam_status_changed",function(){var b=a("#tcs_exam_table").bootstrapTable("getRowByUniqueId",a(this).data("exam_id"));b.visible="true"==b.visible?"false":"true";c.updateTableRow(b)});a("#tcs_exam_table").on("editable-save.bs.table",function(a,b,d){c.updateTableRow(d)});a("body").on("click","#tcs_edit_manual_exam",function(){var d=a("#tcs_exam_table").bootstrapTable("getRowByUniqueId",a(this).data("id")),e=JSON.parse(JSON.stringify(d));e.opening_date=b.unixToDate(e.opening_date);e.closing_date=b.unixToDate(e.closing_date);c.stored_edit_obj=e;c.modalAddEditManualExam(e,"edit")});a("body").on("click","#tcs_remove_exam",function(){var b=a("#tcs_exam_table").bootstrapTable("getRowByUniqueId",a(this).data("id"));b.finished="true";c.updateTableRow(b);a("#tcs_exam_table").bootstrapTable("updateRow",{row:b.id})});a("body").on("click","#tcs_bring_back_manual_exam",function(){var b=a("#tcs_exam_table").bootstrapTable("getRowByUniqueId",a(this).data("id"));b.finished="false";c.updateTableRow(b);a("#tcs_exam_table").bootstrapTable("updateRow",{row:b.id})});a(".exam_filter_btn").on("click",function(){var b=a(this).data("filterby"),c="";if("manual"==b){c={manual:"true"}}else if("visible"==b){c={visible:"true"}}else if("hidden"==b){c={visible:"false"}}else if("subnet"==b){c={subnet:"true"}}else if("finished"==b){c={finished:"true"}}else{c={}}a("#tcs_exam_table").bootstrapTable("filterBy",c)});a("#add_manual_exam_btn").on("click",function(){var a=b.getCurrentDate();c.modalAddEditManualExam({current_date:a,opening_date:a+" 09:00:00",closing_date:a+" 21:00:00"},"add")})}}});
//# sourceMappingURL=tcs_exam_table.min.js.map
