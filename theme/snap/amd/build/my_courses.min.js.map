{"version":3,"file":"my_courses.min.js","sources":["../src/my_courses.js"],"sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @package\n * @copyright Copyright (c) 2023 Open LMS (https://www.openlms.net)\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Snap My Courses.\n */\ndefine(['jquery', 'core/log','theme_snap/util', 'theme_snap/ajax_notification'],\n    function($, log, util, ajaxNotify) {\n        /**\n         * Load My courses feeds content when advanced feeds are disabled.\n         *\n         * @param {Boolean} redirectToSitePolicyMyCourses Boolean to redirect to site policy.\n         */\n        var init = function(redirectToSitePolicyMyCourses) {\n            if (redirectToSitePolicyMyCourses) {\n                var redirect = M.cfg.wwwroot + '/user/policy.php';\n                window.location = redirect;\n                return;\n            }\n            $(document).ready(function() {\n                var loadAjaxInfo = function(type) {\n                    // Target for data to be displayed on screen.\n                    var container = $('#snap-my-courses-' + type);\n                    if ($(container).length) {\n                        var cacheKey = M.cfg.sesskey + 'snap-my-courses-' + type;\n                        try {\n                            // Display old content while waiting\n                            if (util.supportsSessionStorage() && window.sessionStorage[cacheKey]) {\n                                log.info('using locally stored ' + type);\n                                var html = window.sessionStorage[cacheKey];\n                                $(container).html(html);\n                            }\n                            log.info('fetching ' + type);\n                            $.ajax({\n                                type: \"GET\",\n                                async: true,\n                                url: M.cfg.wwwroot + '/theme/snap/rest.php?action=get_' + type + '&contextid=' + M.cfg.context,\n                                success: function(data) {\n                                    ajaxNotify.ifErrorShowBestMsg(data).done(function(errorShown) {\n                                        if (errorShown) {\n                                            return;\n                                        } else {\n                                            // No errors, update sesion storage.\n                                            log.info('fetched ' + type);\n                                            if (util.supportsSessionStorage() && typeof (data.html) != 'undefined') {\n                                                window.sessionStorage[cacheKey] = data.html;\n                                            }\n                                            // Note: we can't use .data because that does not manipulate the dom, we need the data\n                                            // attribute populated immediately so things like behat can utilise it.\n                                            // .data just sets the value in memory, not the dom.\n                                            $(container).attr('data-content-loaded', '1');\n                                            $(container).html(data.html);\n                                        }\n                                    });\n                                }\n                            });\n                        } catch (err) {\n                            sessionStorage.clear();\n                            log.error(err);\n                        }\n                    }\n                };\n\n                loadAjaxInfo('deadlines');\n                loadAjaxInfo('graded');\n                loadAjaxInfo('grading');\n                loadAjaxInfo('messages');\n                loadAjaxInfo('forumposts');\n            });\n        };\n        return {\n            init: init,\n        };\n    }\n);"],"names":["define","$","log","util","ajaxNotify","init","redirectToSitePolicyMyCourses","redirect","M","cfg","wwwroot","window","location","document","ready","loadAjaxInfo","type","container","length","cacheKey","sesskey","supportsSessionStorage","sessionStorage","info","html","ajax","async","url","context","success","data","ifErrorShowBestMsg","done","errorShown","attr","err","clear","error"],"mappings":";;;;;;;;;;;;;;;;;;;;AAwBAA,+BAAO,CAAC,SAAU,WAAW,kBAAmB,iCAC5C,SAASC,EAAGC,IAAKC,KAAMC,kBA+DZ,CACHC,KA1DO,SAASC,kCACZA,mCACIC,SAAWC,EAAEC,IAAIC,QAAU,mBAC/BC,OAAOC,SAAWL,cAGtBN,EAAEY,UAAUC,OAAM,eACVC,aAAe,SAASC,UAEpBC,UAAYhB,EAAE,oBAAsBe,SACpCf,EAAEgB,WAAWC,OAAQ,KACjBC,SAAWX,EAAEC,IAAIW,QAAU,mBAAqBJ,YAG5Cb,KAAKkB,0BAA4BV,OAAOW,eAAeH,UAAW,CAClEjB,IAAIqB,KAAK,wBAA0BP,UAC/BQ,KAAOb,OAAOW,eAAeH,UACjClB,EAAEgB,WAAWO,KAAKA,MAEtBtB,IAAIqB,KAAK,YAAcP,MACvBf,EAAEwB,KAAK,CACHT,KAAM,MACNU,OAAO,EACPC,IAAKnB,EAAEC,IAAIC,QAAU,mCAAqCM,KAAO,cAAgBR,EAAEC,IAAImB,QACvFC,QAAS,SAASC,MACd1B,WAAW2B,mBAAmBD,MAAME,MAAK,SAASC,YAC1CA,aAIA/B,IAAIqB,KAAK,WAAaP,MAClBb,KAAKkB,+BAAkD,IAAdS,KAAKN,OAC9Cb,OAAOW,eAAeH,UAAYW,KAAKN,MAK3CvB,EAAEgB,WAAWiB,KAAK,sBAAuB,KACzCjC,EAAEgB,WAAWO,KAAKM,KAAKN,aAKzC,MAAOW,KACLb,eAAec,QACflC,IAAImC,MAAMF,QAKtBpB,aAAa,aACbA,aAAa,UACbA,aAAa,WACbA,aAAa,YACbA,aAAa"}