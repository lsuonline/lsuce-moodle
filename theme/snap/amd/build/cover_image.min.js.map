{"version":3,"file":"cover_image.min.js","sources":["../src/cover_image.js"],"sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @package\n * @copyright Copyright (c) 2015 Open LMS (https://www.openlms.net)\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/log', 'core/ajax', 'core/notification', 'theme_snap/ajax_notification', './cropper'],\n    function($, log, ajax, notification, ajaxNotify, Cropper) {\n\n        var savedImageURL = $('#page-header').css(\"background-image\");\n        var temporalImageURL = 'none';\n        var cropper = null;\n        var cropperRatio = 6/1;\n        if ($('#page-site-index').length) {\n            cropperRatio = 6/2;\n        }\n        // TODO - in Moodle 3.1 we should use the core template for this.\n        var addCoverImageAlert = function(id, msg, position = null) {\n            if (position === \"dialogue\") {\n                var alertPosition = '.snap_cover_image_description';\n            } else {\n                var alertPosition = '#snap-coverimagecontrol';\n            }\n            var closestr = M.util.get_string('closebuttontitle', 'moodle');\n            if (!$(id).length) {\n                $(alertPosition).before(\n                    '<div id=\"' + id + '\" class=\"snap-alert-cover-image alert alert-warning\" role=\"alert\">' +\n                    msg +\n                    '<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"' + closestr + '\">' +\n                    '<span aria-hidden=\"true\">&times;</span>' +\n                    '</button>' +\n                    '</div>'\n                );\n            }\n        };\n\n        /**\n         * Get human file size from bytes.\n         * http://stackoverflow.com/questions/10420352/converting-file-size-in-bytes-to-human-readable.\n         * @param {int} size\n         * @returns {string}\n         */\n        var humanFileSize = function(size) {\n            var i = Math.floor(Math.log(size) / Math.log(1024));\n            return (size / Math.pow(1024, i)).toFixed(2) * 1 + ' ' + ['B', 'kB', 'MB', 'GB', 'TB'][i];\n        };\n\n        /**\n         * First state - image selection button visible.\n         */\n        var state1 = function() {\n            temporalImageURL = 'none';\n            $('#page-header').css('background-image', savedImageURL);\n            if (savedImageURL === \"none\") {\n                $('.path-course-view #page-header').removeClass('mast-image');\n                $('.path-course-view #page-header .breadcrumb-item a').removeClass('mast-breadcrumb');\n            }\n            $('#snap-alert-cover-image-size').remove();\n            $('#snap-alert-cover-image-bytes').remove();\n            $('#snap-coverfiles').val('');\n            $('#snap-changecoverimageconfirmation .ok').removeClass('ajaxing');\n            $('#snap-changecoverimageconfirmation').removeClass('state-visible');\n            $('label[for=\"snap-coverfiles\"]').removeClass('ajaxing');\n            $('label[for=\"snap-coverfiles\"]').addClass('state-visible');\n            $('body').removeClass('cover-image-change');\n        };\n\n        /**\n         * Second state - confirm / cancel buttons visible.\n         */\n        var state2 = function() {\n            $('#snap-alert-cover-image-upload-failed').remove();\n            $('#snap-changecoverimageconfirmation').removeClass('disabled');\n            $('label[for=\"snap-coverfiles\"]').removeClass('state-visible');\n            $('#snap-changecoverimageconfirmation').addClass('state-visible');\n            $('body').removeClass('cover-image-change');\n        };\n\n        /**\n         * Get original image url.\n         * @param {string} url\n         */\n        var getOriginalImageURL = function(url) {\n            var newURL = url;\n            newURL = newURL.replace(\"url(\", \"\");\n            newURL = newURL.replace(\")\", \"\");\n            newURL = newURL.replace(/['\"]+/g, \"\");\n            newURL = newURL.replace(\";\", \"\");\n            newURL = newURL.replace(\"croppedimage\", \"coverimage\");\n            newURL = newURL.replace(\"course-image-cropped\", \"course-image\");\n            newURL = newURL.replace(\"category-image-cropped\", \"category-image\");\n            newURL = newURL.replace(\"site-image-cropped\", \"site-image\");\n            return newURL;\n        };\n\n        /**\n         * Get cropped image url.\n         * @param {string} url\n         */\n        var getCroppedImageURL = function(url) {\n            var newURL = url;\n            newURL = newURL.replace(\"url(\", \"\");\n            newURL = newURL.replace(\")\", \"\");\n            newURL = newURL.replace(/['\"]+/g, \"\");\n            newURL = newURL.replace(\";\", \"\");\n            return newURL;\n        };\n\n        /**\n         * Load current image.\n         */\n        var loadCurrentImage = function() {\n            var currentImageUrl = savedImageURL;\n            if (currentImageUrl === \"none\") {\n                $('.snap_cover_image_save_button').addClass(\"d-none\");\n                return \"\";\n            }\n            $('.snap_cover_image_save_button').removeClass(\"d-none\");\n            currentImageUrl = getOriginalImageURL(currentImageUrl);\n            return currentImageUrl;\n        };\n\n        /**\n         * Moodle dialogue box.\n         * @param {string} courseShortName\n         * @param {int} categoryId\n         * @param {object} fpoptions\n         * @param {int} siteMaxBytes\n         */\n        var moodledialogue = function(courseShortName, categoryId, fpoptions, siteMaxBytes) {\n            var maxbytesstr = humanFileSize(siteMaxBytes);\n            let title = M.util.get_string('imageproperties', 'theme_snap');\n            let coverImageDesc = M.util.get_string('coverimagedesc', 'theme_snap', maxbytesstr);\n            let coverImageCropperDesc = M.util.get_string('coverimagecropperdesc', 'theme_snap');\n            let coverImageSettingsWarning = M.util.get_string('coverimagesettingswarning', 'theme_snap');\n            let browseRepositories = M.util.get_string('browserepositories', 'theme_snap');\n            let selectImageString = M.util.get_string('selectimage', 'theme_snap');\n            let deleteImageString = M.util.get_string('deleteimage', 'theme_snap');\n            let previewDisplay = \"'display:none'\";\n            let currentImageURL = '';\n            if (temporalImageURL !== 'none') {\n                currentImageURL = temporalImageURL;\n            } else {\n                currentImageURL = loadCurrentImage();\n                temporalImageURL = currentImageURL;\n            }\n            if (currentImageURL !== \"\") {\n                 previewDisplay = \"'display:block'\";\n            }\n\n            let content =\n                '<div class=\"mb-1 snap_cover_image_dialogue\">' +\n                    '<p class=\"snap_cover_image_description\">' + coverImageDesc + '</p>' +\n                    '<p class=\"snap_cover_image_cropper_description d-none\">' + coverImageCropperDesc + '</p>' +\n                    '<p class=\"snap_cover_image_cropper_description d-none\">' + coverImageSettingsWarning + '</p>' +\n                    '<div class=\"input-group input-append w-100 snap_cover_image_options\">' +\n                        '<button class=\"btn btn-secondary snap_cover_image_browser\" id=\"id_snap_cover_image_browser\">' +\n                        browseRepositories + '</button>' +\n                        '<button class=\"btn btn-secondary snap_cover_image_delete_image_button d-none\" ' +\n                        'id=\"id_snap_cover_image_delete_image\">' +\n                        deleteImageString + '</button>' +\n                    '</div>' +\n                // Add the image preview.\n                '<div class=\"mdl-align\">' +\n                    '<div class=\"snap_cover_image_preview_box\">' +\n                        '<img id=\"id_snap_cover_image_preview\" class=\"snap_cover_image_preview\" alt=\"\" ' +\n                            'style=' + previewDisplay +\n                            'src=' + currentImageURL + '>' +\n                    '</div>' +\n                '</div>' +\n                // Add the save button.\n                '<div class=\"snap_cover_image_save\">' +\n                        '<button class=\"btn btn-primary snap_cover_image_save_button d-none\" ' +\n                        'id=\"id_snap_cover_image_save_button\">' +\n                         selectImageString + '</button>' +\n                    '</div>' +\n                '</div>';\n\n            var dialogue = new M.core.dialogue({\n                headerContent: title,\n                bodyContent: content,\n                width: '800px',\n                modal: true,\n                visible: false,\n                render: true,\n                additionalBaseClass: 'snap_cover_image_dialogue',\n            });\n            dialogue.show();\n\n            if (savedImageURL !== 'none') {\n                $('.snap_cover_image_delete_image_button').removeClass('d-none');\n            }\n\n            // Preview the original image in the modal.\n            if (currentImageURL !== \"\") {\n                $('.snap_cover_image_save_button').removeClass(\"d-none\");\n                // Initialize preview image cropper for the current saved image.\n                var imageToCrop = document.getElementById('id_snap_cover_image_preview');\n                cropper = new Cropper(imageToCrop, {\n                    viewMode: 3,\n                    aspectRatio: cropperRatio,\n                    dragMode: \"none\",\n                    zoomable: false,\n                    minCropBoxWidth: 300,\n                });\n                $('.snap_cover_image_cropper_description').removeClass('d-none');\n                $('#id_snap_cover_image_save_button').click(function() {\n                    if (cropper.getCroppedCanvas() !== null) {\n                        var croppedImage = cropper.getCroppedCanvas().toDataURL(\"image/png\");\n                        // Ensure that the page-header in courses has the mast-image class.\n                        $('.path-course-view #page-header').addClass('mast-image');\n                        $('.path-course-view #page-header .breadcrumb-item a').addClass('mast-breadcrumb');\n\n                        $('#page-header').css('background-image', 'url(' + croppedImage + ')');\n                        state2();\n                        saveImage({}, courseShortName, categoryId, cropper);\n                    }\n                });\n            }\n\n            // Delete image option.\n            $('.snap_cover_image_delete_image_button').click(function(e) {\n                e.preventDefault();\n                cropper = null;\n                let cancelString = M.util.get_string('cancel', 'moodle');\n                let confirmString = M.util.get_string('yes', 'moodle');\n                let confirmDeleteString = M.util.get_string('confirmdeletefile', 'theme_snap');\n                var cancelButton = '<button id=\"delete_image_cancel_button\" class=\"btn btn-secondary\">' +\n                    cancelString + '</button>';\n                var confirmButton = '<button id=\"delete_image_confirm_button\" ' +\n                    'class=\"btn btn-primary\">' + confirmString + '</button>';\n                dialogue.hide();\n\n                let deleteDialogueContent =\n                    '<div class=\"mb-1 snap_cover_image_delete_dialogue\">' +\n                        '<p class=\"snap_cover_image_delete_description\">' + confirmDeleteString + '</p>' +\n                        // Add the delete confirmation buttons.\n                        '<div class=\"snap_cover_image_delete_confirmation\">' + cancelButton + confirmButton + '</div>' +\n                    '</div>';\n\n                var confirmationDialogue = new M.core.dialogue({\n                    headerContent: title,\n                    bodyContent: deleteDialogueContent,\n                    width: '600px',\n                    modal: true,\n                    visible: false,\n                    render: true,\n                    additionalBaseClass: 'snap_cover_image_delete_image_dialogue',\n                });\n                confirmationDialogue.show();\n                confirmationDialogue.after(\"visibleChange\", function() {\n                    if (!confirmationDialogue.get('visible')) {\n                        state1();\n                        confirmationDialogue.destroy(true);\n                    }\n                });\n\n                $('#delete_image_cancel_button').click(function(e) {\n                    e.preventDefault();\n                    confirmationDialogue.hide();\n                });\n                $('#delete_image_confirm_button').click(function(e) {\n                    e.preventDefault();\n                    var ajaxParams = {};\n                    if (categoryId !== null) {\n                        ajaxParams.categoryid = categoryId;\n                    } else if (courseShortName !== null) {\n                        ajaxParams.courseshortname = courseShortName;\n                    }\n                    ajaxParams.deleteimage = true;\n                    ajax.call([\n                        {\n                            methodname: 'theme_snap_cover_image',\n                            args: {params: ajaxParams},\n                            done: function() {\n                                temporalImageURL = 'none';\n                                savedImageURL = 'none';\n                                cropper = null;\n                                state1();\n                                $('#page-header').removeClass('mast-image');\n                                $('#page-header .breadcrumb-item a').removeClass('mast-breadcrumb');\n                                $('#page-header').data('servercoverfile', 'none');\n                                $('#page-header').css('background-image', 'none');\n                                confirmationDialogue.hide();\n                            },\n                            fail: function(response) {\n                                ajaxNotify.ifErrorShowBestMsg(response);\n                            }\n                        }\n                    ], true, true);\n                });\n            });\n\n            $('body').addClass('cover-image-change');\n            $('label[for=\"snap-coverfiles\"]').addClass('ajaxing');\n\n            $('#id_snap_cover_image_browser').click(function(e) {\n                e.preventDefault();\n                showFilepicker('image', fpoptions, filepickerCallback(courseShortName, categoryId), dialogue);\n            });\n            $('#id_snap_cover_image_save_button').click(function() {\n                dialogue.hide();\n            });\n            $('.snap_cover_image_dialogue .closebutton, .moodle-dialogue-lightbox').click(function() {\n                cropper = null;\n                state1();\n            });\n            dialogue.after(\"visibleChange\", function() {\n                if ($('#snap-changecoverimageconfirmation .ok').hasClass('ajaxing')) {\n                    state2();\n                }\n                if (!dialogue.get('visible')) {\n                    dialogue.destroy(true);\n                }\n            });\n        };\n\n        /**\n         * Load the image in the preview box after being uploaded using the file picker.\n         * @param {object} params\n         * @param {string} courseShortName\n         * @param {int} categoryId\n         */\n        var loadPreviewImage = function(params, courseShortName, categoryId) {\n\n            var image = new Image();\n            image.onerror = function() {\n                var preview = document.getElementById('id_snap_cover_image_preview');\n                preview.setAttribute('style', 'display:none');\n            };\n\n            image.onload = function() {\n                var input;\n                var imageWidth = this.width;\n                input = document.getElementById('id_snap_cover_image_preview');\n                input.setAttribute('src', params.url);\n                input.setAttribute('style', 'display:block');\n                $('.snap_cover_image_save_button').removeClass(\"d-none\");\n\n                // Warn if image resolution is too small.\n                if (imageWidth < 1024) {\n                    $('#snap-alert-cover-image-size').remove();\n                    addCoverImageAlert('snap-alert-cover-image-size',\n                        M.util.get_string('error:coverimageresolutionlow', 'theme_snap'),\n                        'dialogue'\n                    );\n                } else {\n                    $('#snap-alert-cover-image-size').remove();\n                }\n\n                if (cropper !== null) {\n                    cropper.replace(params.url);\n                } else {\n                    // Initialize preview image cropper for the uploaded image.\n                    var imageToCrop = document.getElementById('id_snap_cover_image_preview');\n                    temporalImageURL = params.url;\n                    cropper = new Cropper(imageToCrop, {\n                        viewMode: 3,\n                        aspectRatio: cropperRatio,\n                        dragMode: \"none\",\n                        zoomable: false,\n                        minCropBoxWidth: 300,\n                    });\n                }\n                $('.snap_cover_image_cropper_description').removeClass('d-none');\n                $('#id_snap_cover_image_save_button').click(function() {\n                    var croppedImage = cropper.getCroppedCanvas().toDataURL(\"image/png\");\n                    // Ensure that the page-header in courses has the mast-image class.\n                    $('.path-course-view #page-header').addClass('mast-image');\n                    $('.path-course-view #page-header .breadcrumb-item a').addClass('mast-breadcrumb');\n\n                    $('#page-header').css('background-image', 'url(' + croppedImage + ')');\n\n                    state2();\n                    saveImage(params, courseShortName, categoryId, cropper);\n                });\n\n            };\n            image.src = params.url;\n        };\n\n\n        /**\n         * Callback for file picker.\n         * @param {string} courseShortName\n         * @param {int} categoryId\n         */\n        var filepickerCallback = function(courseShortName, categoryId) {\n            return function(params) {\n            if (params.url !== '') {\n                temporalImageURL = params.url;\n                // Load the preview image.\n                loadPreviewImage(params, courseShortName, categoryId);\n                }\n            };\n        };\n\n        /**\n         * Create file picker.\n         * @param {string} type\n         * @param {object} fpoptions\n         * @param {Function} callback\n         * @param {object} dialogue\n         */\n        var showFilepicker = function(type, fpoptions, callback, dialogue) {\n            Y.use('core_filepicker', function(Y) {\n                var options = fpoptions;\n                options.formcallback = callback;\n                M.core_filepicker.show(Y, options);\n            });\n            $('.filepicker .closebutton').click(function() {\n                dialogue.hide();\n                state1();\n            });\n        };\n\n        /**\n         * Save image after confirmation.\n         * @param {object} params\n         * @param {string} courseShortName\n         * @param {int} categoryId\n         * @param {object} cropper\n         */\n        var saveImage = function(params, courseShortName, categoryId, cropper) {\n\n            $('#snap-changecoverimageconfirmation .ok').off('click').click(function() {\n                var ajaxParams = {};\n\n                if (categoryId !== null) {\n                    ajaxParams.categoryid = categoryId;\n                } else if (courseShortName !== null) {\n                    ajaxParams.courseshortname = courseShortName;\n                } else {\n                    return;\n                }\n\n                if (params.id !== undefined) {\n                    ajaxParams.fileid = params.id;\n                } else if (params.file !== undefined) {\n                        var fileNameWithoutSpaces = params.file.replace(/ .*/, \"\");\n                        var regex = new RegExp(\"draft\\\\/(\\\\d+)\\\\/\" + fileNameWithoutSpaces, \"g\");\n                        var urlId = params.url.match(regex);\n                        ajaxParams.fileid = urlId[0].match(/\\d+/)[0];\n                }\n\n                if (params.file !== undefined) {\n                    ajaxParams.imagefilename = params.file;\n                }\n                if (params.url !== undefined) {\n                    ajaxParams.originalimageurl = params.url;\n                } else {\n                    ajaxParams.originalimageurl = '';\n                }\n\n                cropper.getCroppedCanvas().toBlob((blob) => {\n                    var reader = new FileReader();\n                    reader.readAsDataURL(blob);\n                    reader.onloadend = function() {\n                        var imageBase64Data = reader.result;\n                        ajaxParams.croppedimagedata = imageBase64Data;\n                        ajax.call([\n                            {\n                                methodname: 'theme_snap_cover_image',\n                                args: {params: ajaxParams},\n                                done: function(response) {\n                                    state1();\n                                    if (response.contrast) {\n                                        addCoverImageAlert('snap-alert-cover-image-size',\n                                            response.contrast\n                                        );\n                                    }\n                                    if (!response.success && response.warning) {\n                                        addCoverImageAlert('snap-alert-cover-image-upload-failed', response.warning);\n                                    }\n                                    var newUrl = getCroppedImageURL(response.imageurl);\n                                    savedImageURL = 'url(' + newUrl + ')';\n                                    temporalImageURL = 'none';\n                                    $('#page-header').css('background-image', savedImageURL);\n                                    $('#page-header').addClass('mast-image');\n                                    $('#page-header .breadcrumb-item a').addClass('mast-breadcrumb');\n                                    $('#page-header').data('servercoverfile', $('#page-header').css('background-image'));\n                                    $('#snap-changecoverimageconfirmation .ok').off(\"click\");\n\n                                },\n                                fail: function(response) {\n                                    state1();\n                                    ajaxNotify.ifErrorShowBestMsg(response);\n                                }\n                            }\n                        ], true, true);\n                    };\n                });\n\n            });\n        };\n\n        /**\n         *\n         * @param {object} ajaxParams\n         * @param {string} courseShortName\n         * @param {int} categoryId\n         * @param {int} siteMaxBytes\n         */\n        var coverImage = function(ajaxParams, courseShortName = null, categoryId = null, siteMaxBytes) {\n\n            if (courseShortName === null && categoryId === null) {\n                return;\n            }\n\n            ajax.call([\n                {\n                    methodname: 'theme_snap_file_manager_options',\n                    args: [],\n                    done: function(data) {\n                        var fpoptions = JSON.parse(data.fpoptions);\n                        // Take a backup of what the current background image url is (if any).\n                        $('#page-header').data('servercoverfile', $('#page-header').css('background-image'));\n                        $('#snap-coverimagecontrol').addClass('snap-js-enabled');\n                        $('#snap-coverfiles').click(function() {\n                            moodledialogue(courseShortName, categoryId, fpoptions, siteMaxBytes);\n                        });\n                        // Cancel button listener\n                        $('#snap-changecoverimageconfirmation .cancel').click(function() {\n                            moodledialogue(courseShortName, categoryId, fpoptions, siteMaxBytes);\n                        });\n                    },\n                    fail: function() {\n                        return;\n                    }\n                }\n            ], true, true);\n        };\n\n        /**\n         * @param {int} categoryId\n         * @param {int} siteMaxBytes\n         */\n        var categoryCoverImage = function(categoryId, siteMaxBytes) {\n            var ajaxParams = {imagefilename: null, imagedata: null, categoryid: categoryId,\n                    courseshortname: null};\n            coverImage(ajaxParams, null, categoryId, siteMaxBytes);\n        };\n\n        /**\n         * @param {string} courseShortName\n         * @param {int} siteMaxBytes\n         */\n        var courseCoverImage = function(courseShortName, siteMaxBytes) {\n            var ajaxParams = {imagefilename: null, imagedata: null, categoryid: null,\n                    courseshortname: courseShortName};\n\n            coverImage(ajaxParams, courseShortName, null, siteMaxBytes);\n        };\n        return {courseImage: courseCoverImage, categoryImage: categoryCoverImage};\n    }\n);\n"],"names":["define","$","log","ajax","notification","ajaxNotify","Cropper","savedImageURL","css","temporalImageURL","cropper","cropperRatio","length","addCoverImageAlert","id","msg","position","alertPosition","closestr","M","util","get_string","before","state1","removeClass","remove","val","addClass","state2","moodledialogue","courseShortName","categoryId","fpoptions","siteMaxBytes","size","i","maxbytesstr","Math","floor","pow","toFixed","title","coverImageDesc","coverImageCropperDesc","coverImageSettingsWarning","browseRepositories","selectImageString","deleteImageString","previewDisplay","currentImageURL","currentImageUrl","replace","content","dialogue","core","headerContent","bodyContent","width","modal","visible","render","additionalBaseClass","show","imageToCrop","document","getElementById","viewMode","aspectRatio","dragMode","zoomable","minCropBoxWidth","click","getCroppedCanvas","croppedImage","toDataURL","saveImage","e","preventDefault","cancelString","confirmString","confirmDeleteString","cancelButton","confirmButton","hide","deleteDialogueContent","confirmationDialogue","after","get","destroy","ajaxParams","categoryid","courseshortname","deleteimage","call","methodname","args","params","done","data","fail","response","ifErrorShowBestMsg","showFilepicker","filepickerCallback","hasClass","url","image","Image","onerror","setAttribute","onload","input","imageWidth","this","src","loadPreviewImage","type","callback","Y","use","options","formcallback","core_filepicker","off","undefined","fileid","file","fileNameWithoutSpaces","regex","RegExp","urlId","match","imagefilename","originalimageurl","toBlob","blob","reader","FileReader","readAsDataURL","onloadend","imageBase64Data","result","croppedimagedata","contrast","success","warning","newUrl","imageurl","coverImage","JSON","parse","courseImage","imagedata","categoryImage"],"mappings":"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"}