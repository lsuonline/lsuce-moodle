/**
 * This file is part of Moodle - http://moodle.org/
 *
 * Moodle is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Moodle is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @package
 * @copyright Copyright (c) 2024 Open LMS (https://www.openlms.net)
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("theme_snap/snap_feeds",["jquery","core/log","theme_snap/util","theme_snap/ajax_notification"],(function($,log,util,ajaxNotify){var modifyHTML=function(html){const regex=new RegExp('<div class="snap-media-body">\n<a href="(.*)"><h3>',"g"),results=[...html.matchAll(regex)];let modifiedHTML=html;return results.length>0?(results.forEach((result=>{const originalURL=result[1],modifiedURL=originalURL+"&snapfeedsclicked=on";modifiedHTML=modifiedHTML.replace(originalURL,modifiedURL)})),modifiedHTML):html},applyListeners=function(urlParameter){$(document).on("click",".js-snap-feeds-side-menu-trigger",(function(event){$("#snap_feeds_side_menu").is(":visible")&&function(urlParameter){$(document).ready((function(){var loadAjaxInfo=function(type){var container=$("#snap-feeds-menu-"+type),mobileContainer=$("#snap-feeds-section-"+type);if($(container).length){var cacheKey=M.cfg.sesskey+"snap-feeds-menu-"+type;try{if(util.supportsSessionStorage()&&window.sessionStorage[cacheKey]){log.info("using locally stored "+type);var html=window.sessionStorage[cacheKey];$(container).html(html),$(mobileContainer).html(html)}log.info("fetching "+type),$.ajax({type:"GET",async:!0,url:M.cfg.wwwroot+"/theme/snap/rest.php?action=get_"+type+"&contextid="+M.cfg.context,success:function(data){ajaxNotify.ifErrorShowBestMsg(data).done((function(errorShown){if(!errorShown)if(log.info("fetched "+type),util.supportsSessionStorage()&&void 0!==data.html&&(window.sessionStorage[cacheKey]=data.html),$(container).attr("data-content-loaded","1"),$(mobileContainer).attr("data-content-loaded","1"),urlParameter){let modifiedHTML=modifyHTML(data.html);$(container).html(modifiedHTML),$(mobileContainer).html(modifiedHTML)}else $(container).html(data.html),$(mobileContainer).html(data.html)}))}})}catch(err){sessionStorage.clear(),log.error(err)}}};loadAjaxInfo("deadlines"),loadAjaxInfo("graded"),loadAjaxInfo("grading"),loadAjaxInfo("messages"),loadAjaxInfo("forumposts")}))}(urlParameter),event.preventDefault()})),$(".snap-feeds-mobile-menu .nav-item").on("click",(function(){$(".snap-feeds-mobile-menu .nav-item").removeClass("active"),$(this).addClass("active"),$(".snap-feeds-mobile-menu .snap-feeds-mobile-sections > div").removeClass("active");let target=$(this).data("target");$(".snap-feeds-mobile-menu #snap-feeds-section-"+target).addClass("active")}))};return{init:function(urlParameter){applyListeners(urlParameter)}}}));

//# sourceMappingURL=snap_feeds.min.js.map