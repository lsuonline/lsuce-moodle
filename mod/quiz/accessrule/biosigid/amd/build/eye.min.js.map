{"version":3,"sources":["../src/eye.js"],"names":["init","bsiUsername","pageUrl","bioDomain","bs","path","url","relativeUrl","append","elmnt","pos1","pos2","pos3","pos4","elementDrag","e","window","event","preventDefault","clientX","clientY","style","top","offsetTop","left","offsetLeft","closeDragElement","document","onmouseup","onmousemove","onmousedown","getElementById","each","text","remove","biosight","console","log","rurl","biosightclient","findSession","s","status","error","css","session","stopOnReviewPage","beforeUnload","waitForBioSight","setTimeout","endsWith","stop","bind"],"mappings":"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","sourcesContent":["import jQuery from 'jquery';\nimport biosightclient from 'quizaccess_biosigid/biosightclient';\nimport url from 'core/url';\n\nexport const init = (bsiUsername, pageUrl, bioDomain) => {\n    var bs;\n    var pageurl = pageUrl;\n    var path = url.relativeUrl(pageurl, \"\");\n\n    jQuery('body').append(`<div id=\\\"biosight_info\\\" style=\\\"position: fixed; z-index: 9999; top: 15px; left: 100px;\n        padding: 5px; background-image: linear-gradient(lightblue, steelblue); box-shadow: 0px 0px 0px 8px rgba(128, 128, 128, 0.5);\n        border-radius: 2px; height: 68px; font-family: Arial; font-weight: bold; font-size: 14px; text-align: center;\n         cursor: move;\\\">BioSight-ID&trade;: <i class=\\\"fa fa-eye fa-4x\\\" style=\\\"vertical-align: middle;\\\"></div>`);\n\n    function dragElement(elmnt) {\n        var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;\n        function dragMouseDown(e) {\n            e = e || window.event;\n            e.preventDefault();\n            pos3 = e.clientX;\n            pos4 = e.clientY;\n            document.onmouseup = closeDragElement;\n            document.onmousemove = elementDrag;\n        }\n        function elementDrag(e) {\n            e = e || window.event;\n            e.preventDefault();\n            pos1 = pos3 - e.clientX;\n            pos2 = pos4 - e.clientY;\n            pos3 = e.clientX;\n            pos4 = e.clientY;\n            elmnt.style.top = (elmnt.offsetTop - pos2) + \"px\";\n            elmnt.style.left = (elmnt.offsetLeft - pos1) + \"px\";\n        }\n        function closeDragElement() {\n            document.onmouseup = null;\n            document.onmousemove = null;\n        }\n        elmnt.onmousedown = dragMouseDown;\n    }\n    dragElement(document.getElementById(\"biosight_info\"));\n\n    // Read the buttons in the page and remove Return to attempt.\n    jQuery(\"button[type='submit']\").each(function() {\n        if (jQuery(this).text() == 'Return to attempt') {\n            jQuery(this).remove();\n        }\n    });\n\n    var biosight = function () {\n        window.console.log(path);\n        window.console.log('BioSight Loaded...');\n        var rurl = 'https://' + bioDomain;\n        biosightclient.findSession(rurl + '/biosight/findsession', bsiUsername, function (s) {\n\n            if (s.status !== 'ok') {\n                window.console.error('Cannot find BioSight session!');\n                jQuery('#biosight_info i').css('color', 'orange');\n                return;\n            }\n\n            bs = biosightclient(rurl + '/bioSightHub', s.session, function () {\n                    window.console.log('BioSight Fail!');\n                    jQuery('#biosight_info i').css('color', 'red');\n                }, function () {\n                    window.console.log('BioSight OK!');\n                    jQuery('#biosight_info i').css('color', 'green');\n                }, function () {\n                    window.console.log('BioSight Started!');\n                    jQuery('#biosight_info i').css('color', 'gray');\n                    stopOnReviewPage();\n                    beforeUnload();\n                }\n            );\n        });\n    };\n\n    var waitForBioSight = function () {\n        if (typeof biosightclient !== 'undefined') {\n            biosight();\n        } else {\n            setTimeout(waitForBioSight, 100);\n        }\n    };\n    waitForBioSight();\n\n    function stopOnReviewPage() {\n        window.console.log('Path ends with review? result:' + path.endsWith('review.php'));\n\n        if (path.endsWith('review.php')) {\n            if (typeof bs !== 'undefined') {\n                jQuery('#biosight_info').remove();\n                window.console.log('Review page: BioSight Stopped!');\n                bs.stop();\n            }\n        }\n    }\n\n    // Stop biosight when student finishes.\n    // The only option is to validate if a student is leaving the summary page.\n    // In that case, we remove the floating element and stop the Biosight script.\n    function beforeUnload() {\n        jQuery(window).bind('beforeunload', function() {\n            if (path.endsWith('summary.php') || path.endsWith('review.php')) {\n                jQuery('#biosight_info').remove();\n                if (typeof bs !== 'undefined') {\n                    window.console.log('Before unload summary or review. BioSight Stopped!');\n                    bs.stop();\n                }\n            }\n        });\n    }\n\n};\n"],"file":"eye.min.js"}